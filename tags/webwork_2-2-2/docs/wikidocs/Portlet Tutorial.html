<html>
    <head>
        <title>WebWork - 
        Portlet Tutorial
         </title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <h1><a name="PortletTutorial-Index"></a>Index</h1>

<ol>
	<li><a href="#PortletTutorial-intro" title="intro on Portlet Tutorial">Introduction</a></li>
	<li><a href="#PortletTutorial-installeclipse" title="install_eclipse on Portlet Tutorial">Installing Eclipse</a></li>
	<li><a href="#PortletTutorial-installjboss" title="install_jboss on Portlet Tutorial">Installing JBoss Portal 2.2</a></li>
	<li><a href="#PortletTutorial-createproject" title="create_project on Portlet Tutorial">Creating the project</a></li>
	<li><a href="#PortletTutorial-classpath" title="classpath on Portlet Tutorial">Classpath settings</a></li>
	<li><a href="#PortletTutorial-portlet.xml" title="portlet.xml on Portlet Tutorial">portlet.xml</a></li>
	<li><a href="#PortletTutorial-web.xml" title="web.xml on Portlet Tutorial">web.xml</a></li>
	<li><a href="#PortletTutorial-helloworld" title="hello_world on Portlet Tutorial">Hello World\!</a></li>
	<li><a href="#PortletTutorial-xwork.xml" title="xwork.xml on Portlet Tutorial">xwork.xml</a></li>
	<li><a href="#PortletTutorial-jbossdescriptors" title="jboss_descriptors on Portlet Tutorial">JBoss Portal descriptors</a></li>
	<li><a href="#PortletTutorial-deployment" title="deployment on Portlet Tutorial">Deployment</a></li>
	<li><a href="#PortletTutorial-next" title="next on Portlet Tutorial">Next step</a></li>
	<li><a href="#PortletTutorial-redeploy" title="redeploy on Portlet Tutorial">Re-deployment</a></li>
</ol>




<h1><a name="PortletTutorial-StepbyStepTutorial"></a>Step-by-Step Tutorial</h1>


<h2><a name="PortletTutorial-Introduction"></a>Introduction <a name="PortletTutorial-intro"></a></h2>

<p>This tutorial walks you through the process of building a simple portlet application, using Eclipse, JBoss Portal 2.2 and the WebWork Portlet framework.</p>

<h2><a name="PortletTutorial-InstallingEclipse"></a>Installing Eclipse <a name="PortletTutorial-installeclipse"></a></h2>

<p>In the tutorial, we will be using Eclipse 3.1.1 which can be downloaded from <a href="http://www.eclipse.org" title="Visit page outside Confluence">&#104;ttp://www.eclipse.org</a></p>

<h2><a name="PortletTutorial-InstallingJBossPortal2.2"></a>Installing JBoss Portal 2.2 <a name="PortletTutorial-installjboss"></a></h2>

<p>JBoss Portal 2.2 can be found at <a href="http://www.jboss.com/products/jbossportal/downloads" title="Visit page outside Confluence">&#104;ttp://www.jboss.com/products/jbossportal/downloads</a>.</p>

<h2><a name="PortletTutorial-Creatingtheproject"></a>Creating the project <a name="PortletTutorial-createproject"></a></h2>

<p>A Portlet application is basically packaged as a regular web application, but with an additional descriptor; portlet.xml. The first step of the tutorial is to create the project structure in eclipse. First, let's create the Java project itself using the new project wizard. We call the project 'MyPortlet'. Make sure to select the "Create separate source and output folders" radio button, and hit "next". In the next wizard step, set the output folder for the 'src' source folder to 'MyPortlet/webapp/WEB-INF/classes'. This makes sure it will be easy for us to export the application as a WAR file when we're done.</p>

<p><em>New project wizard</em></p>

<p><img src="Portlet Tutorial_attachments/new-project-1.jpg" align="absmiddle" border="0" /></p>

<p><em>New project wizard, cont</em></p>

<p><img src="Portlet Tutorial_attachments/new-project-2.jpg" align="absmiddle" border="0" /></p>

<h2><a name="PortletTutorial-Classpathsettings"></a>Classpath settings <a name="PortletTutorial-classpath"></a></h2>

<p>Before buliding the application itself, we need to add some required jar files to the build classpath and the WEB-INF/lib folder. Firstly, create the WEB-INF/lib folder and download the WebWork 2.2.1 distribution and unzip it to your local harddrive. Locate the jar files shown in the screenshot and and put them in the newly created WEB-INF/lib folder. Select all the jar files, and right click and select "Build Path &#45;&gt; Add to Build Path". Now your local project should look similar to the screenshot.</p>

<p><img src="Portlet Tutorial_attachments/buildpath.jpg" align="absmiddle" border="0" /></p>

<h2><a name="PortletTutorial-portlet.xml"></a>portlet.xml <a name="PortletTutorial-portlet.xml"></a></h2>

<p>Next thing we do is create a portlet.xml file in the WEB-INF folder. In this file, write the following:</p>
<div class="code"><div class="codeHeader"><b>portlet.xml</b></div><div class="codeContent">
<pre class="code-java">&lt;portlet-app version=<span class="code-quote">"1.0"</span> xmlns=<span class="code-quote">"http:<span class="code-comment">//java.sun.com/xml/ns/portlet/portlet-app_1_0.xsd"</span>
</span>         xmlns:xsi=<span class="code-quote">"http:<span class="code-comment">//www.w3.org/2001/XMLSchema-instance"</span>
</span>xsi:schemaLocation=<span class="code-quote">"http:<span class="code-comment">//java.sun.com/xml/ns/portlet/portlet-app_1_0.xsd http://java.sun.com/xml/ns/portlet/portlet-app_1_0.xsd"</span>&gt;
</span>  &lt;portlet&gt;
    &lt;description xml:lang=<span class="code-quote">"EN"</span>&gt;My very first WebWork Portlet&lt;/description&gt;
    &lt;portlet-name&gt;MyPortlet&lt;/portlet-name&gt;
    &lt;display-name xml:lang=<span class="code-quote">"EN"</span>&gt;My first WebWork Portlet&lt;/display-name&gt;

    &lt;portlet-class&gt;com.opensymphony.webwork.portlet.dispatcher.Jsr168Dispatcher&lt;/portlet-class&gt;

    &lt;init-param&gt;
      &lt;!-- The view mode namespace. Maps to a namespace in the xwork config file --&gt;
      &lt;name&gt;viewNamespace&lt;/name&gt;
      &lt;value&gt;/view&lt;/value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
      &lt;!-- The <span class="code-keyword">default</span> action to invoke in view mode --&gt;
      &lt;name&gt;defaultViewAction&lt;/name&gt;
      &lt;value&gt;index&lt;/value&gt;
    &lt;/init-param&gt;

    &lt;expiration-cache&gt;0&lt;/expiration-cache&gt;

    &lt;supports&gt;
      &lt;mime-type&gt;text/html&lt;/mime-type&gt;
    &lt;/supports&gt;

    &lt;supported-locale&gt;en&lt;/supported-locale&gt;

    &lt;portlet-info&gt;
      &lt;title&gt;My very own WebWork Portlet&lt;/title&gt;
      &lt;<span class="code-object">short</span>-title&gt;WWPortlet&lt;/<span class="code-object">short</span>-title&gt;
      &lt;keywords&gt;webwork,portlet&lt;/keywords&gt;
    &lt;/portlet-info&gt;
  &lt;/portlet&gt;
&lt;/portlet-app&gt;</pre>
</div></div>
<p>&nbsp;</p>

<p>This portlet.xml file sets up the portlet using the <em>com.opensymphony.webwork.portlet.dispatcher.Jsr168Dispatcher</em> Portlet implementation. It also tells the Portlet that it will map the <em>view</em> portlet mode to a <em>/view</em> namespace in the XWork configuration, which we must remember when building our XWork actions. In addition, it tells the portlet that if it does not find an action parameter in the portlet request, the default action to invoke is the "index" action, which<br/>
should reside in the <em>/view</em> namespace in our xwork configuration.</p>

<h2><a name="PortletTutorial-web.xml"></a>web.xml <a name="PortletTutorial-web.xml"></a></h2>

<p>The WebWork Portlet support also requires you to include a web.xml descriptor that sets up some special servlets and filters needed to enable support for the WebWork tag libraries and template languages, since it relies on some of the interfaces and classes in the Servlet API. So create a web.xml file in the WEB-INF folder, and add the following:</p>
<div class="code"><div class="codeHeader"><b>web.xml</b></div><div class="codeContent">
<pre class="code-java">&lt;?xml version=<span class="code-quote">"1.0"</span> encoding=<span class="code-quote">"UTF-8"</span>?&gt;
&lt;!DOCTYPE web-app PUBLIC <span class="code-quote">"-<span class="code-comment">//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"</span> <span class="code-quote">"http://java.sun.com/dtd/web-app_2_3.dtd"</span>&gt;
</span>&lt;web-app&gt;
	&lt;filter&gt;
		&lt;filter-name&gt;webwork&lt;/filter-name&gt;
		&lt;filter-class&gt;
			com.opensymphony.webwork.dispatcher.FilterDispatcher
		&lt;/filter-class&gt;
	&lt;/filter&gt;

	&lt;filter-mapping&gt;
		&lt;filter-name&gt;webwork&lt;/filter-name&gt;
		&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
	&lt;/filter-mapping&gt;

	&lt;listener&gt;
		&lt;listener-class&gt;
			com.opensymphony.webwork.portlet.context.ServletContextHolderListener
		&lt;/listener-class&gt;
	&lt;/listener&gt;


	&lt;servlet&gt;
		&lt;servlet-name&gt;preparator&lt;/servlet-name&gt;
		&lt;servlet-class&gt;
			com.opensymphony.webwork.portlet.context.PreparatorServlet
		&lt;/servlet-class&gt;
	&lt;/servlet&gt;

	&lt;taglib&gt;
		&lt;taglib-uri&gt;/webwork&lt;/taglib-uri&gt;
		&lt;taglib-location&gt;/WEB-INF/lib/webwork-2.2.1.jar&lt;/taglib-location&gt;
	&lt;/taglib&gt;

&lt;/web-app&gt;</pre>
</div></div>
<p>&nbsp;</p>

<p>The FilterDispatcher makes sure that URLs to stylesheets and js files within the webwork jar file resolve correctly. The ServletContextHolderListener is a Servlet context listener that stores a reference to the servlet context of the web application. This is needed by some of the initialization procedures used in the WebWork Portlet. The 'preparator' servlet is a special servlet that, before dispatching to a view (like JSP/ftl or velocity) initializes the HttpServletRequest/Response, and other Servlet API classes in the ServletActionContext that is used in many of the JSPs and templates.</p>

<h2><a name="PortletTutorial-HelloWorld%5C%21"></a>Hello World&#33; <a name="PortletTutorial-helloworld"></a></h2>

<p>With these basic project structure, <em>portlet.xml</em> and <em>web.xml</em> in place, it's time to do the mandatory "Hello World" example, so let's create a place to store our JSP files. Create a <em>WEB-INF/pages/view</em> folder, and within this folder, create the file "helloWorld.jsp". In this file, we simply put:</p>
<div class="code"><div class="codeHeader"><b>helloWorld.jsp</b></div><div class="codeContent">
<pre class="code-java">&lt;H2&gt;Hello world!&lt;/H2&gt;</pre>
</div></div>
<p>&nbsp;</p>

<h2><a name="PortletTutorial-xwork.xml"></a>xwork.xml <a name="PortletTutorial-xwork.xml"></a></h2>

<p>At this point, it's time to prepare the xwork configuration file, xwork.xml. Create an empty file named xwork.xml in the root of the 'src' folder. In this file we put:</p>
<div class="code"><div class="codeHeader"><b>xwork.xml</b></div><div class="codeContent">
<pre class="code-java">&lt;?xml version=<span class="code-quote">"1.0"</span> encoding=<span class="code-quote">"ISO-8859-1"</span>?&gt;
&lt;!DOCTYPE xwork PUBLIC
    <span class="code-quote">"-<span class="code-comment">//OpenSymphony Group//XWork 1.0//EN"</span>
</span>    <span class="code-quote">"http:<span class="code-comment">//www.opensymphony.com/xwork/xwork-1.0.dtd"</span>&gt;
</span>&lt;xwork&gt;
	&lt;include file=<span class="code-quote">"webwork-<span class="code-keyword">default</span>.xml"</span> /&gt;

	&lt;<span class="code-keyword">package</span> name=<span class="code-quote">"view"</span> <span class="code-keyword">extends</span>=<span class="code-quote">"webwork-portlet-<span class="code-keyword">default</span>"</span>
		namespace=<span class="code-quote">"/view"</span>&gt;
		&lt;action name=<span class="code-quote">"index"</span>
			class=<span class="code-quote">"com.opensymphony.xwork.ActionSupport"</span>&gt;
			&lt;result name=<span class="code-quote">"success"</span>&gt;/WEB-INF/pages/view/helloWorld.jsp&lt;/result&gt;
		&lt;/action&gt;
	&lt;/<span class="code-keyword">package</span>&gt;
&lt;/xwork&gt;</pre>
</div></div>
<p>&nbsp;</p>

<p>Some important things to notice are that we create a package with namespace <em>view</em>, and our package extends the <em>webwork-portlet-default</em> package. The <em>webwork-portlet-default</em> package contains some special result types needed to run WebWork/XWork in a portlet container.</p>

<h2><a name="PortletTutorial-JBossPortaldescriptors"></a>JBoss Portal descriptors <a name="PortletTutorial-jbossdescriptors"></a></h2>

<p>In addition to the regular <em>portlet.xml</em> and <em>web.xml</em> descriptors, JBoss Portal 2.2 requires us to add a couple of JBoss specific descriptor files. On of these descriptor files is named according to the name of the context root of our application, which in this case is the name of the exported war file itself. We will later create a war file named MyPortlet.war, so the name of the JBoss descriptor becomes 'MyPortlet-object.xml'. So we create this file in the WEB-INF folder, and insert the following text:</p>
<div class="code"><div class="codeHeader"><b>MyPortlet-object.xml</b></div><div class="codeContent">
<pre class="code-java">&lt;?xml version=<span class="code-quote">"1.0"</span> encoding=<span class="code-quote">"UTF-8"</span>?&gt;
&lt;deployments&gt;
	&lt;deployment&gt;
		&lt;<span class="code-keyword">if</span>-exists&gt;overwrite&lt;/<span class="code-keyword">if</span>-exists&gt;
		&lt;parent-ref&gt;<span class="code-keyword">default</span>&lt;/parent-ref&gt;
		&lt;properties /&gt;
		&lt;page&gt;
			&lt;page-name&gt;MyPortlet Tutorial&lt;/page-name&gt;
			&lt;properties /&gt;
			&lt;window&gt;
				&lt;window-name&gt;MyPortletWindow&lt;/window-name&gt;
				&lt;instance-ref&gt;MyPortletInstance&lt;/instance-ref&gt;
				&lt;region&gt;center&lt;/region&gt;
				&lt;height&gt;0&lt;/height&gt;
			&lt;/window&gt;
		&lt;/page&gt;
	&lt;/deployment&gt;
	&lt;deployment&gt;
		&lt;<span class="code-keyword">if</span>-exists&gt;overwrite&lt;/<span class="code-keyword">if</span>-exists&gt;
		&lt;instance&gt;
			&lt;instance-name&gt;MyPortletInstance&lt;/instance-name&gt;
			&lt;component-ref&gt;MyPortlet.MyPortlet&lt;/component-ref&gt;
		&lt;/instance&gt;
	&lt;/deployment&gt;
&lt;/deployments&gt;</pre>
</div></div>
<p>&nbsp;</p>

<p>In addition, we need two other files, <em>jboss-app.xml</em> and <em>jboss-portlet.xml</em> which looks like this:</p>
<div class="code"><div class="codeHeader"><b>jboss-app.xml</b></div><div class="codeContent">
<pre class="code-java">&lt;jboss-app&gt;
   &lt;app-name&gt;MyPortlet&lt;/app-name&gt;
&lt;/jboss-app&gt;</pre>
</div></div>
<p>&nbsp;</p>
<div class="code"><div class="codeHeader"><b>jboss-portlet.xml</b></div><div class="codeContent">
<pre class="code-java">&lt;portlet-app&gt;
   &lt;portlet&gt;
      &lt;portlet-name&gt;MyPortlet&lt;/portlet-name&gt;
      &lt;security&gt;
      &lt;/security&gt;
   &lt;/portlet&gt;
&lt;/portlet-app&gt;</pre>
</div></div>
<p>&nbsp;</p>

<h2><a name="PortletTutorial-Deployment"></a>Deployment</h2>

<p>Now we have a project structure that looks like this:</p>

<p><em>Project structure</em><br/>
<img src="Portlet Tutorial_attachments/project-structure-hello-world-1.jpg" align="absmiddle" border="0" /></p>

<p>Now it's time to try our incredible HelloWorld portlet. In a Windows Explorer session, we select the WEB-INF folder and zip it up and name the file 'MyPortlet.war'. Drop this war file in the server/default/deploy folder of JBoss Portal, and start the server. By default, the URL for JBoss portal is <a href="http://localhost:8080/portal" title="Visit page outside Confluence">&#104;ttp://localhost:8080/portal</a>, so point your browser to this address, and you will get to the front page of the portal, where you should get a "MyPortlet Tutorial" menu entry, as shown in the screenshot below. When pressing this menu link, you will get to our fantastic "Hello World" page&#33;</p>

<p><em>JBoss Portal front page</em><br/>
<img src="Portlet Tutorial_attachments/jboss-portal-frontpage.jpg" align="absmiddle" border="0" /></p>

<p><em>MyPortlet portlet page</em><br/>
<img src="Portlet Tutorial_attachments/jboss-portal-portlet-page.jpg" align="absmiddle" border="0" /></p>

<h2><a name="PortletTutorial-Nextstep"></a>Next step <a name="PortletTutorial-next"></a></h2>

<p>Next, let's do something a bit more interesting, namely create a simple form and display a result page. Let's start by creating our JSP that displays our form. Create a new file, 'helloForm.jsp' in the WEB-INF/pages/view/ folder. We will use the WebWork tag library to build the form on our page. The form itself will ask the user for a first name and last name, something like this:</p>
<div class="code"><div class="codeHeader"><b>helloForm.jsp</b></div><div class="codeContent">
<pre class="code-java">&lt;%@ taglib uri=<span class="code-quote">"/webwork"</span> prefix=<span class="code-quote">"ww"</span> %&gt;

&lt;H2&gt;Hi there! Please enter your name&lt;/H2&gt;
&lt;ww:form action=<span class="code-quote">"helloWorld"</span> method=<span class="code-quote">"POST"</span>&gt;
	&lt;ww:textfield label=<span class="code-quote">"First name"</span> name=<span class="code-quote">"firstName"</span> value=<span class="code-quote">"%{firstName}"</span>/&gt;
	&lt;ww:textfield label=<span class="code-quote">"Last name"</span> name=<span class="code-quote">"lastName"</span> value=<span class="code-quote">"%{lastName}"</span>/&gt;
	&lt;ww:submit value=<span class="code-quote">"Say hello!"</span>/&gt;
&lt;/ww:form&gt;</pre>
</div></div>
<p>&nbsp;</p>

<p>Now we're ready to code some Java, not much, but at least a little bit. We create a new package in our <em>src</em> folder, let's name it <em>com.opensymphony.webwork.portlet.tutorial</em>. In this package, create a <em>HelloWorldAction</em> class. In usual WebWork manners, this class extends the ActionSupport class from the XWork framework, and we'll add a couple of properties that maps to our form in the JSP we just created:</p>
<div class="code"><div class="codeHeader"><b>HelloWorldAction.java</b></div><div class="codeContent">
<pre class="code-java"><span class="code-keyword">package</span> com.opensymphony.webwork.portlet.tutorial;

<span class="code-keyword">import</span> com.opensymphony.xwork.ActionSupport;

<span class="code-keyword">public</span> class HelloWorldAction <span class="code-keyword">extends</span> ActionSupport {
	<span class="code-keyword">private</span> <span class="code-object">String</span> firstName;
	<span class="code-keyword">private</span> <span class="code-object">String</span> lastName;
	<span class="code-keyword">public</span> <span class="code-object">String</span> getFirstName() {
		<span class="code-keyword">return</span> firstName;
	}
	<span class="code-keyword">public</span> void setFirstName(<span class="code-object">String</span> firstName) {
		<span class="code-keyword">this</span>.firstName = firstName;
	}
	<span class="code-keyword">public</span> <span class="code-object">String</span> getLastName() {
		<span class="code-keyword">return</span> lastName;
	}
	<span class="code-keyword">public</span> void setLastName(<span class="code-object">String</span> lastName) {
		<span class="code-keyword">this</span>.lastName = lastName;
	}
}</pre>
</div></div>
<p>&nbsp;</p>

<p>We also need a JSP to display the processed input. We'll just use the old helloWorld.jsp and modify it a bit. As with <em>helloForm.jsp</em>, we import the WebWork tag library, and we use the <em>ww:property</em> tags to display the input from the form:</p>
<div class="code"><div class="codeHeader"><b>helloWorld.jsp</b></div><div class="codeContent">
<pre class="code-java">&lt;%@ taglib prefix=<span class="code-quote">"ww"</span> uri=<span class="code-quote">"/webwork"</span> %&gt;

&lt;H2&gt;Hello &lt;ww:property value=<span class="code-quote">"firstName"</span>/&gt; &lt;ww:property value=<span class="code-quote">"lastName"</span>/&gt;&lt;/H2&gt;
&lt;p/&gt;
&lt;a xhref=<span class="code-quote">"&lt;ww:url action="</span>helloWorldInput<span class="code-quote">"/&gt;"</span>&gt;Back to form&lt;/a&gt;</pre>
</div></div>
<p>&nbsp;</p>

<h2><a name="PortletTutorial-Redeployment"></a>Re-deployment <a name="PortletTutorial-redeploy"></a></h2>

<p>Now we're ready to do a re-deployment of our application, so zip up a new war and drop it in the <em>server/default/deploy</em> folder. The "MyPortlet Tutorial" page will now display:</p>

<p><em>Hello World form</em><br/>
<img src="Portlet Tutorial_attachments/hello-world-form-1.jpg" align="absmiddle" border="0" /></p>

<p>Enter some data, and press the "Say hello&#33;" button, and you will get a nice little personalized "hello" message:</p>

<p><em>Personalized Hello World</em></p>

<p><img src="Portlet Tutorial_attachments/hello-world-result-1.jpg" align="absmiddle" border="0" /></p>

                    			    </td>
		    </tr>
	    </table>
    </body>
</html>
