<html>
    <head>
        <title>WebWork 2 : xwork.xml</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=GBK">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            WebWork 2 : xwork.xml
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on May 26, 2004 by <font color="#0050B2">ctran</font>.
				    </div>

				    <p class="paragraph"><h2 style="margin: 4px 0px 4px 0px;" class="heading2"><a name="xwork.xml-Example"> 示例</a></h2></p><div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;&#63;xml version=<span class="xml&#45;quote">&quot;1.0&quot;</span> encoding=<span class="xml&#45;quote">&quot;ISO&#45;8859&#45;1&quot;</span>&#63;&gt;</span>&#10;<span class="xml&#45;tag">&lt;&#33;DOCTYPE xwork &#10;          PUBLIC &#10;          <span class="xml&#45;quote">&quot;&#45;//OpenSymphony Group//XWork 1.0//EN&quot;</span> &#10;          <span class="xml&#45;quote">&quot;&#104;ttp://www.opensymphony.com/xwork/xwork&#45;1.0.dtd&quot;</span>&gt;</span>&#10;<span class="xml&#45;tag">&lt;xwork&gt;</span>&#10;    <span class="xml&#45;tag">&lt;include file=<span class="xml&#45;quote">&quot;webwork&#45;default.xml&quot;</span>/&gt;</span>&#10;    &#10;    <span class="xml&#45;tag">&lt;package name=<span class="xml&#45;quote">&quot;default&quot;</span> extends=<span class="xml&#45;quote">&quot;webwork&#45;default&quot;</span>&gt;</span>&#10;&#10;        <span class="xml&#45;tag">&lt;interceptors&gt;</span>&#10;            <span class="xml&#45;tag">&lt;interceptor&#45;stack name=<span class="xml&#45;quote">&quot;defaultComponentStack&quot;</span>&gt;</span>&#10;                <span class="xml&#45;tag">&lt;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;component&quot;</span>/&gt;</span>&#10;                <span class="xml&#45;tag">&lt;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;defaultStack&quot;</span>/&gt;</span>&#10;            <span class="xml&#45;tag">&lt;/interceptor&#45;stack&gt;</span>&#10;        <span class="xml&#45;tag">&lt;/interceptors&gt;</span>&#10;&#10;        <span class="xml&#45;tag">&lt;default&#45;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;defaultStack&quot;</span>/&gt;</span>&#10;&#10;        <span class="xml&#45;tag">&lt;action name=<span class="xml&#45;quote">&quot;SimpleCounter&quot;</span> class=<span class="xml&#45;quote">&quot;com.opensymphony.webwork.example.counter.SimpleCounter&quot;</span>&gt;</span>&#10;            <span class="xml&#45;tag">&lt;result name=<span class="xml&#45;quote">&quot;success&quot;</span> type=<span class="xml&#45;quote">&quot;dispatcher&quot;</span>&gt;</span>/success.jsp<span class="xml&#45;tag">&lt;/result&gt;</span>&#10;            <span class="xml&#45;tag">&lt;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;defaultComponentStack&quot;</span>/&gt;</span>&#10;        <span class="xml&#45;tag">&lt;/action&gt;</span>&#10;&#10;        <span class="xml&#45;tag"><span class="xml&#45;comment">&lt;&#33;&#45;&#45;&#10;          &#45; Velocity implementation of the SimpleCounter.  Also demonstrate a more verbose version of result element&#10;          &#45;&#45;&gt;</span></span>&#10;        <span class="xml&#45;tag">&lt;action name=<span class="xml&#45;quote">&quot;VelocityCounter&quot;</span> class=<span class="xml&#45;quote">&quot;com.opensymphony.webwork.example.counter.SimpleCounter&quot;</span>&gt;</span>&#10;            <span class="xml&#45;tag">&lt;result name=<span class="xml&#45;quote">&quot;success&quot;</span> type=<span class="xml&#45;quote">&quot;velocity&quot;</span>&gt;</span>&#10;                <span class="xml&#45;tag">&lt;param name=<span class="xml&#45;quote">&quot;location&quot;</span>&gt;</span>/success.vm<span class="xml&#45;tag">&lt;/param&gt;</span>&#10;            <span class="xml&#45;tag">&lt;/result&gt;</span>&#10;            <span class="xml&#45;tag">&lt;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;defaultComponentStack&quot;</span>/&gt;</span>&#10;        <span class="xml&#45;tag">&lt;/action&gt;</span>&#10;&#10;        <span class="xml&#45;tag"><span class="xml&#45;comment">&lt;&#33;&#45;&#45;&#10;            &#45; Different method can be used (processForm). &#10;            &#45;&#45;&gt;</span></span>&#10;        <span class="xml&#45;tag">&lt;action name=<span class="xml&#45;quote">&quot;formTest&quot;</span> class=<span class="xml&#45;quote">&quot;com.opensymphony.webwork.example.FormAction&quot;</span> method=<span class="xml&#45;quote">&quot;processForm&quot;</span> &gt;</span>&#10;            <span class="xml&#45;tag">&lt;result name=<span class="xml&#45;quote">&quot;success&quot;</span> type=<span class="xml&#45;quote">&quot;dispatcher&quot;</span>&gt;</span>/formSuccess.jsp<span class="xml&#45;tag">&lt;/result&gt;</span>&#10;            <span class="xml&#45;tag">&lt;result name=<span class="xml&#45;quote">&quot;invalid.token&quot;</span> type=<span class="xml&#45;quote">&quot;dispatcher&quot;</span>&gt;</span>/form.jsp<span class="xml&#45;tag">&lt;/result&gt;</span>&#10;            <span class="xml&#45;tag">&lt;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;defaultStack&quot;</span>/&gt;</span>&#10;            <span class="xml&#45;tag">&lt;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;token&quot;</span>/&gt;</span>&#10;        <span class="xml&#45;tag">&lt;/action&gt;</span>&#10;&#10;    <span class="xml&#45;tag">&lt;/package&gt;</span>&#10;<span class="xml&#45;tag">&lt;/xwork&gt;</span></pre>
</div></div><p class="paragraph"><h2 class="heading2"><a name="xwork.xml-Actions"> 活动</a></h2></p><div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;action name=<span class="xml&#45;quote">&quot;formTest&quot;</span> class=<span class="xml&#45;quote">&quot;com.opensymphony.webwork.example.FormAction&quot;</span> method=<span class="xml&#45;quote">&quot;processForm&quot;</span>&gt;</span></pre>
</div></div><p class="paragraph">活动是WebWork的基本工作单元, 它正是定义了活动. 活动通常有一个请求(通常是点击按钮, 或提交表单). 主要的action元素有两部分, 友好的名字(在URL中引用, 如saveForm.action)和对应的&quot;处理(handler)&quot;类.</p>可选的&quot;<b class="strong">method</b>&quot;属性告诉WebWork应当调用活动的哪个方法. 如果你不填写method属性, WebWork缺省调用<b class="strong">execute()</b>. 如果活动没有execute()方法, 也没有在xml中指定method属性, WebWork将抛出异常.   <p class="paragraph">同样, 你也可以在表单中指定&quot;<b class="strong">actionName!something</b>&quot;来告诉WebWork调用&quot;<b class="strong">doSomething</b>&quot;方法.  例如, &quot;<b class="strong">formTest!save.action</b>&quot;将调用FormAction的&quot;<b class="strong">save</b>&quot;方法.  该方法必须是public且没有参数:</p><div class="code"><div class="codeContent">
<pre><span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">String</span> save() <span class="java&#45;keyword">throws</span> Exception&#10;  &#123;&#10;      ...&#10;      <span class="java&#45;keyword">return</span> SUCCESS;&#10;  &#125;</pre>
</div></div><p class="paragraph">活动的所有配置都可以用在&quot;actionName!something&quot;中(截取器, 结果类型等)</p><h2 class="heading2"><a name="xwork.xml-Results"> 结果</a></h2>
<div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;result name=<span class="xml&#45;quote">&quot;missing&#45;data&quot;</span> type=<span class="xml&#45;quote">&quot;dispatcher&quot;</span>&gt;</span>&#10;    <span class="xml&#45;tag">&lt;param name=<span class="xml&#45;quote">&quot;location&quot;</span>&gt;</span>/form.jsp<span class="xml&#45;tag">&lt;/param&gt;</span>&#10;    <span class="xml&#45;tag">&lt;param name=<span class="xml&#45;quote">&quot;parameterA&quot;</span>&gt;</span>A<span class="xml&#45;tag">&lt;/param&gt;</span>&#10;    <span class="xml&#45;tag">&lt;param name=<span class="xml&#45;quote">&quot;parameterB&quot;</span>&gt;</span>B<span class="xml&#45;tag">&lt;/param&gt;</span>&#10;<span class="xml&#45;tag">&lt;/result&gt;</span></pre>
</div></div><p class="paragraph">Result元素告诉WebWork活动执行后下一步该做什么.   &quot;name&quot;属性对应活动execute() 方法返回的结果代码.  &quot;type&quot;属性表示使用哪个结果类型(参见<a href="Result Types.html" title="Result Types">结果类型</a>).  可以使用&quot;param&quot;元素向视图传递参数: <br/>
<div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;result&#45;types&gt;</span>&#10;     ....&#10;    <span class="xml&#45;tag">&lt;result&#45;type name=<span class="xml&#45;quote">&quot;header&quot;</span>                    &#10;         class=<span class="xml&#45;quote">&quot;com.opensymphony.webwork.dispatcher.HttpHeaderResult&quot;</span>/&gt;</span>&#10;		&#10;<span class="xml&#45;tag">&lt;/result&#45;types&gt;</span>&#10;&#10;<span class="xml&#45;tag">&lt;result name=<span class="xml&#45;quote">&quot;no&#45;content&quot;</span> type=<span class="xml&#45;quote">&quot;header&quot;</span>&gt;</span>&#10;    <span class="xml&#45;tag">&lt;param name=<span class="xml&#45;quote">&quot;status&quot;</span>&gt;</span>204<span class="xml&#45;tag">&lt;/param&gt;</span>&#10;    <span class="xml&#45;tag">&lt;param name=<span class="xml&#45;quote">&quot;headers.customHeaderA&quot;</span>&gt;</span>A<span class="xml&#45;tag">&lt;/param&gt;</span>&#10;    <span class="xml&#45;tag">&lt;param name=<span class="xml&#45;quote">&quot;headers.customHeaderB&quot;</span>&gt;</span>B<span class="xml&#45;tag">&lt;/param&gt;</span>&#10;<span class="xml&#45;tag">&lt;/result&gt;</span></pre>
</div></div></p>下面是WebWork内置的标准结果代码(定义在Action接口中), 包括: 
<div class="code"><div class="codeContent">
<pre>Action.SUCCESS = <span class="java&#45;quote">&quot;success&quot;</span>;&#10;Action.NONE    = <span class="java&#45;quote">&quot;none&quot;</span>;&#10;Action.ERROR   = <span class="java&#45;quote">&quot;error&quot;</span>;&#10;Action.INPUT   = <span class="java&#45;quote">&quot;input&quot;</span>;&#10;Action.LOGIN   = <span class="java&#45;quote">&quot;login&quot;</span>;</pre>
</div></div><p class="paragraph">你可以扩充你认为适合的结果代码(如&quot;missing-data&quot;). 大多数情况下你只需使用SUCCESS和ERROR, SUCCESS将前进到下一个页面.</p>如果你只需要指定&quot;location&quot;属性, 可以使用简写形式:
<div class="code"><div class="codeContent">
<pre>&lt;result name=<span class="java&#45;quote">&quot;missing&#45;data&quot;</span> type=<span class="java&#45;quote">&quot;dispatcher&quot;</span>&gt;/form.jsp&lt;/result&gt;</pre>
</div></div><p class="paragraph">参阅<a href="webwork-default.xml.html" title="webwork-default.xml">webwork-default.xml</a>或<a href="Result Types.html" title="Result Types">Result Types</a>以了解标准结果类型</p><h2 class="heading2"><a name="xwork.xml-Interceptors"> 截取器</a></h2><p class="paragraph">截取器允许定义活动执行前后的代码. 截取器是编写Web应用的强大工具. 一些最常用的实现是: 
<ul class="star">
<li> 安全检查(确保用户已登陆)</li>
<li> 跟踪纪录 (记录每一个活动)</li>
<li> 检查执行瓶颈 (在活动前后启动计时器, 以检查应用瓶颈)<br/>
也可以将截取器连接起来创建一个截取器<b class="strong">栈</b>. 如果你想完成登陆检查, 安全检查, 并记录每个活动调用, 使用截取器栈会十分容易.
</li>
</ul><br/>
必须先定义截取器(给它命名)然后才能联接成栈:</p><div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;interceptors&gt;</span>&#10;  <span class="xml&#45;tag">&lt;interceptor name=<span class="xml&#45;quote">&quot;security&quot;</span> class=<span class="xml&#45;quote">&quot;com.mycompany.security.SecurityInterceptor&quot;</span>/&gt;</span>&#10;  <span class="xml&#45;tag">&lt;interceptor&#45;stack name=<span class="xml&#45;quote">&quot;defaultComponentStack&quot;</span>&gt;</span>&#10;    <span class="xml&#45;tag">&lt;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;component&quot;</span>/&gt;</span>&#10;    <span class="xml&#45;tag">&lt;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;defaultStack&quot;</span>/&gt;</span>&#10;  <span class="xml&#45;tag">&lt;/interceptor&#45;stack&gt;</span>&#10;<span class="xml&#45;tag">&lt;/interceptors&gt;</span></pre>
</div></div><p class="paragraph">要在活动中使用它们:
<div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;action name=<span class="xml&#45;quote">&quot;VelocityCounter&quot;</span> class=<span class="xml&#45;quote">&quot;com.opensymphony.webwork.example.counter.SimpleCounter&quot;</span>&gt;</span>&#10;   <span class="xml&#45;tag">&lt;result name=<span class="xml&#45;quote">&quot;success&quot;</span>&gt;</span>...<span class="xml&#45;tag">&lt;/result&gt;</span>&#10;   <span class="xml&#45;tag">&lt;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;defaultComponentStack&quot;</span>/&gt;</span>&#10;<span class="xml&#45;tag">&lt;/action&gt;</span></pre>
</div></div></p>注意: 可以引用拦截器或栈的名字<p class="paragraph">更多细节参见<a href="Interceptors.html" title="Interceptors">截取器</a>.</p><h2 class="heading2"><a name="xwork.xml-Views"> 视图</a></h2><p class="paragraph">WebWork支持JSP和Velocity作为应用表示层. 本例使用JSP文件. Webwork附带了标签库(taglibs). 你可以在JSP中项组件一样使用标签库.下面是form.jsp的片断:</p><div class="code"><div class="codeContent">
<pre>&lt;&#37;&#64; taglib prefix=<span class="java&#45;quote">&quot;ww&quot;</span> uri=<span class="java&#45;quote">&quot;webwork&quot;</span> &#37;&gt;&#10;&lt;html&gt;&#10;&lt;head&gt;&lt;title&gt;Webwork Form Example&lt;/title&gt;&lt;/head&gt;&#10;&lt;body&gt;&#10;   &lt;ww:form name=<span class="java&#45;quote">&quot;myForm&quot;</span> action=<span class="java&#45;quote">&quot;&#039;formTest&#039;&quot;</span> namespace=<span class="java&#45;quote">&quot;/&quot;</span> method=<span class="java&#45;quote">&quot;POST&quot;</span>&gt;&#10;  &lt;table&gt;&#10;    &lt;ww:textfield label=<span class="java&#45;quote">&quot;First Name&quot;</span> name=<span class="java&#45;quote">&quot;&#039;formBean.firstName&#039;&quot;</span> value=<span class="java&#45;quote">&quot;formBean.firstName&quot;</span>/&gt;&#10;    &lt;ww:textfield label=<span class="java&#45;quote">&quot;Last Name&quot;</span> name=<span class="java&#45;quote">&quot;&#039;formBean.lastName&#039;&quot;</span> value=<span class="java&#45;quote">&quot;formBean.lastName&quot;</span>/&gt;&#10;    &lt;ww:submit value=<span class="java&#45;quote">&quot;Save Form&quot;</span>/&gt;&#10;  &lt;/table&gt;&#10;&lt;/ww:form&gt;&#10;&lt;/body&gt;</pre>
</div></div><p class="paragraph">处理经过如下:</p><ol>
<li> WebWork监控以<b class="strong">.action</b>结尾的URI(定义在<b class="strong">web.xml</b>中)</li>
<li> WebWork在活动定义中查找活动<b class="strong">formTest</b>.</li>
<li> WebWork创建<b class="strong">formTest</b>并调用<b class="strong">com.opensymphony.webwork.example.FormAction</b>的方法<b class="strong">processForm</b>(定义在<b class="strong">xwork.xml</b>中).</li>
<li> 该方法处理成功并返回<b class="strong">SUCCESS</b></li>
<li> WebWork将返回值<b class="strong">SUCCESS</b>转换成地址<b class="strong">formSuccess.jsp</b>(定义在b class="strong">xwork.xml</b>中)并执行重定向.</li>
</ol>
<h2 class="heading2"><a name="xwork.xml-Include"> 包含</a></h2><p class="paragraph">为了易于管理大规模开发活动(包含大量活动和配置), WebWork允许在xwork.xml中包含其他配置文件 :</p><div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;xwork&gt;</span>&#10;    <span class="xml&#45;tag">&lt;include file=<span class="xml&#45;quote">&quot;webwork&#45;default.xml&quot;</span>/&gt;</span>&#10;    <span class="xml&#45;tag">&lt;include file=<span class="xml&#45;quote">&quot;user.xml&quot;</span>/&gt;</span>&#10;    <span class="xml&#45;tag">&lt;include file=<span class="xml&#45;quote">&quot;shoppingcart.xml&quot;</span>/&gt;</span>&#10;    <span class="xml&#45;tag">&lt;include file=<span class="xml&#45;quote">&quot;product.xml&quot;</span>/&gt;</span>&#10;    ....&#10;<span class="xml&#45;tag">&lt;/xwork&gt;</span></pre>
</div></div><p class="paragraph">被包含文件必须与xwork.xml的格式相同(具有相同的doctype及其它)并放置在类路径中(通常位于/WEB-INF/classes或/WEB-INF/lib的jar文件中).</p>本文的大部分内容由Matt Dowell&lt;matt.dowell@notiva.com&gt;提供

				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="border/border_bottom.gif"><img src="border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Dec 14, 2004 16:37</font></td>
		    </tr>
	    </table>
    </body>
</html>