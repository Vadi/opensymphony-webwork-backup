<html>
    <head>
        <title>WebWork 2 : TutorialLesson05</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=GBK">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            WebWork 2 : TutorialLesson05
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Sep 16, 2004 by <font color="#0050B2">vitorsouza</font>.
				    </div>

				    <p class="paragraph"><h1 style="margin: 4px 0px 4px 0px;" class="heading1"><a name="TutorialLesson05-Lesson5%3AInterceptors"> 第五课: 截取器(Interceptors)</a></h1></p>截取器可以将任意代码包含在调用栈中活动执行前或之后, 它可以极大的简化代码同时提供增强代码复用能力. XWork和WebWork的许多特性多作为截取器实现, 可以和你自己的拦截器一起通过外部配置任意指定顺序并配置在任意活动上.<p class="paragraph">换言之, 当你访问一个<tt class="monospaced">&#42;.action</tt>的地址, WebWork的 class="monospaced">ServletDispatcher</tt>执行一个活动调用. 在活动执行前, 这一调用可以被另一个对象截取, 这个对象就称为截取器. 要想在一个活动执行之前(或之后)设置一个截取器, 只需正确配置<tt class="monospaced">xwork.xml</tt>, 如下例所示, 借用自<a href="TutorialLesson04-01-01.html" title="TutorialLesson04-01-01">4.1.1</a>:</p><h3 class="heading3"><a name="TutorialLesson05-Interceptorconfigurationfromlesson4.1.1%3A"> 4.1.1中的截取器配置:</a></h3>
<div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;action name=<span class="xml&#45;quote">&quot;formProcessing&quot;</span> class=<span class="xml&#45;quote">&quot;lesson04&#95;01&#95;01.FormProcessingAction&quot;</span>&gt;</span> &#10;	<span class="xml&#45;tag">&lt;result name=<span class="xml&#45;quote">&quot;input&quot;</span> type=<span class="xml&#45;quote">&quot;dispatcher&quot;</span>&gt;</span>ex01&#45;index.jsp<span class="xml&#45;tag">&lt;/result&gt;</span> &#10;	<span class="xml&#45;tag">&lt;result name=<span class="xml&#45;quote">&quot;success&quot;</span> type=<span class="xml&#45;quote">&quot;dispatcher&quot;</span>&gt;</span>ex01&#45;success.jsp<span class="xml&#45;tag">&lt;/result&gt;</span> &#10;	<span class="xml&#45;tag">&lt;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;validationWorkflowStack&quot;</span> /&gt;</span> &#10;<span class="xml&#45;tag">&lt;/action&gt;</span></pre>
</div></div><p class="paragraph">如你所见, 4.1.1中的活动<tt class="monospaced">formProcessing</tt>使用了<tt class="monospaced">validationWorkflowStack</tt>. 它是一个截取器栈, 栈中按照截取器的执行顺序进行组织. 这个截取器栈定义在<tt class="monospaced">webwork-default.xml</tt>, 这样我们需要做的就是在活动配置的<tt class="monospaced">&lt;interceptor-ref /&gt;</tt>或包配置中的<tt class="monospaced">&lt;default-interceptor-ref /&gt;</tt>中声明, 就像<a href="TutorialLesson03.html" title="TutorialLesson03">第三课</a>的第一个例一样:</p><h3 class="heading3"><a name="TutorialLesson05-Interceptorconfigurationfromlesson3.1%3A"> 3.1中的截取器配置:</a></h3>
<div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;&#33;DOCTYPE xwork PUBLIC <span class="xml&#45;quote">&quot;&#45;//OpenSymphony Group//XWork 1.0//EN&quot;</span> &#10;<span class="xml&#45;quote">&quot;&#104;ttp://www.opensymphony.com/xwork/xwork&#45;1.0.dtd&quot;</span>&gt;</span>&#10;&#10;<span class="xml&#45;tag">&lt;xwork&gt;</span>&#10;	<span class="xml&#45;tag"><span class="xml&#45;comment">&lt;&#33;&#45;&#45; Include webwork defaults (from WebWork JAR). &#45;&#45;&gt;</span></span>&#10;	<span class="xml&#45;tag">&lt;include file=<span class="xml&#45;quote">&quot;webwork&#45;default.xml&quot;</span> /&gt;</span>&#10;	&#10;	<span class="xml&#45;tag"><span class="xml&#45;comment">&lt;&#33;&#45;&#45; Configuration for the default package. &#45;&#45;&gt;</span></span>&#10;	<span class="xml&#45;tag">&lt;package name=<span class="xml&#45;quote">&quot;default&quot;</span> extends=<span class="xml&#45;quote">&quot;webwork&#45;default&quot;</span>&gt;</span>&#10;		<span class="xml&#45;tag"><span class="xml&#45;comment">&lt;&#33;&#45;&#45; Default interceptor stack. &#45;&#45;&gt;</span></span> &#10;		<span class="xml&#45;tag">&lt;default&#45;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;defaultStack&quot;</span> /&gt;</span> &#10;		&#10;		<span class="xml&#45;tag"><span class="xml&#45;comment">&lt;&#33;&#45;&#45; Action: Lesson 03: HelloWebWorldAction. &#45;&#45;&gt;</span></span> &#10;		<span class="xml&#45;tag">&lt;action name=<span class="xml&#45;quote">&quot;helloWebWorld&quot;</span> class=<span class="xml&#45;quote">&quot;lesson03.HelloWebWorldAction&quot;</span>&gt;</span> &#10;			<span class="xml&#45;tag">&lt;result name=<span class="xml&#45;quote">&quot;success&quot;</span> type=<span class="xml&#45;quote">&quot;dispatcher&quot;</span>&gt;</span>ex01&#45;success.jsp<span class="xml&#45;tag">&lt;/result&gt;</span> &#10;		<span class="xml&#45;tag">&lt;/action&gt;</span> &#10;	<span class="xml&#45;tag">&lt;/package&gt;</span>&#10;<span class="xml&#45;tag">&lt;/xwork&gt;</span></pre>
</div></div><p class="paragraph">让我们先看看它是如何工作的:</p><ol>
<li> 创建一个截取器类, 它实现了<tt class="monospaced">com.opensymphony.xwork.interceptor.Interceptor</tt>接口 (包含在<tt class="monospaced">xwork-1.0.jar</tt>中);</li>
<li> 在XML配置文件(<tt class="monospaced">xwork.xml</tt>)中使用嵌套在<tt class="monospaced">&lt;interceptors /&gt;</tt>中的元素<tt class="monospaced">&lt;interceptor /&gt;</tt>声明该类;</li>
<li> 使用<tt class="monospaced">&lt;interceptor-stack /&gt;</tt>元素(<em class="emphasis">可选的</em>)创建截取器栈;</li>
<li> 使用<tt class="monospaced">&lt;interceptor-ref /&gt;</tt> 或<tt class="monospaced">&lt;default-interceptor-ref /&gt;</tt>决定活动使用那些截取器. 这个样板定义了该截取器被用于一个指定的活动, 而之后指定缺省截取器栈用于那些没有指定<tt class="monospaced">&lt;interceptor-ref /&gt;</tt>的活动.</li>
</ol><br/>
深入观察<tt class="monospaced">webwork-default.xml</tt>我们可以发现这是怎样做到的:<p class="paragraph"><h3 class="heading3"><a name="TutorialLesson05-webworkdefault.xml%3A"> webwork-default.xml:</a></h3>
<div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;&#33;DOCTYPE xwork PUBLIC <span class="xml&#45;quote">&quot;&#45;//OpenSymphony Group//XWork 1.0//EN&quot;</span> &#10;<span class="xml&#45;quote">&quot;&#104;ttp://www.opensymphony.com/xwork/xwork&#45;1.0.dtd&quot;</span>&gt;</span>&#10;&#10;<span class="xml&#45;tag">&lt;xwork&gt;</span>&#10;	<span class="xml&#45;tag">&lt;package name=<span class="xml&#45;quote">&quot;webwork&#45;default&quot;</span>&gt;</span>&#10;		<span class="xml&#45;tag">&lt;result&#45;types&gt;</span>&#10;			<span class="xml&#45;tag">&lt;result&#45;type name=<span class="xml&#45;quote">&quot;dispatcher&quot;</span> default=<span class="xml&#45;quote">&quot;true&quot;</span>&#10;				class=<span class="xml&#45;quote">&quot;com.opensymphony.webwork.dispatcher.ServletDispatcherResult&quot;</span>/&gt;</span>&#10;			<span class="xml&#45;tag">&lt;result&#45;type name=<span class="xml&#45;quote">&quot;redirect&quot;</span> &#10;				class=<span class="xml&#45;quote">&quot;com.opensymphony.webwork.dispatcher.ServletRedirectResult&quot;</span>/&gt;</span>&#10;			<span class="xml&#45;tag">&lt;result&#45;type name=<span class="xml&#45;quote">&quot;velocity&quot;</span> &#10;				class=<span class="xml&#45;quote">&quot;com.opensymphony.webwork.dispatcher.VelocityResult&quot;</span>/&gt;</span>&#10;			<span class="xml&#45;tag">&lt;result&#45;type name=<span class="xml&#45;quote">&quot;chain&quot;</span> &#10;				class=<span class="xml&#45;quote">&quot;com.opensymphony.xwork.ActionChainResult&quot;</span>/&gt;</span>&#10;			<span class="xml&#45;tag">&lt;result&#45;type name=<span class="xml&#45;quote">&quot;xslt&quot;</span> &#10;				class=<span class="xml&#45;quote">&quot;com.opensymphony.webwork.views.xslt.XSLTResult&quot;</span>/&gt;</span>&#10;		<span class="xml&#45;tag">&lt;/result&#45;types&gt;</span>&#10;	&#10;		<span class="xml&#45;tag">&lt;interceptors&gt;</span>&#10;			<span class="xml&#45;tag">&lt;interceptor name=<span class="xml&#45;quote">&quot;timer&quot;</span> &#10;				class=<span class="xml&#45;quote">&quot;com.opensymphony.xwork.interceptor.TimerInterceptor&quot;</span>/&gt;</span>&#10;			<span class="xml&#45;tag">&lt;interceptor name=<span class="xml&#45;quote">&quot;logger&quot;</span> &#10;				class=<span class="xml&#45;quote">&quot;com.opensymphony.xwork.interceptor.LoggingInterceptor&quot;</span>/&gt;</span>&#10;			<span class="xml&#45;tag">&lt;interceptor name=<span class="xml&#45;quote">&quot;chain&quot;</span> &#10;				class=<span class="xml&#45;quote">&quot;com.opensymphony.xwork.interceptor.ChainingInterceptor&quot;</span>/&gt;</span>&#10;			<span class="xml&#45;tag">&lt;interceptor name=<span class="xml&#45;quote">&quot;static&#45;params&quot;</span> &#10;				class=<span class="xml&#45;quote">&quot;com.opensymphony.xwork.interceptor.StaticParametersInterceptor&quot;</span>/&gt;</span>&#10;			<span class="xml&#45;tag">&lt;interceptor name=<span class="xml&#45;quote">&quot;params&quot;</span> &#10;				class=<span class="xml&#45;quote">&quot;com.opensymphony.xwork.interceptor.ParametersInterceptor&quot;</span>/&gt;</span>&#10;			<span class="xml&#45;tag">&lt;interceptor name=<span class="xml&#45;quote">&quot;model&#45;driven&quot;</span> &#10;				class=<span class="xml&#45;quote">&quot;com.opensymphony.xwork.interceptor.ModelDrivenInterceptor&quot;</span>/&gt;</span>&#10;			<span class="xml&#45;tag">&lt;interceptor name=<span class="xml&#45;quote">&quot;component&quot;</span> &#10;				class=<span class="xml&#45;quote">&quot;com.opensymphony.xwork.interceptor.component.ComponentInterceptor&quot;</span>/&gt;</span>&#10;			<span class="xml&#45;tag">&lt;interceptor name=<span class="xml&#45;quote">&quot;token&quot;</span> &#10;				class=<span class="xml&#45;quote">&quot;com.opensymphony.webwork.interceptor.TokenInterceptor&quot;</span>/&gt;</span>&#10;			<span class="xml&#45;tag">&lt;interceptor name=<span class="xml&#45;quote">&quot;token&#45;session&quot;</span> &#10;				class=<span class="xml&#45;quote">&quot;com.opensymphony.webwork.interceptor.TokenSessionStoreInterceptor&quot;</span>/&gt;</span>&#10;			<span class="xml&#45;tag">&lt;interceptor name=<span class="xml&#45;quote">&quot;validation&quot;</span> &#10;				class=<span class="xml&#45;quote">&quot;com.opensymphony.xwork.validator.ValidationInterceptor&quot;</span>/&gt;</span>&#10;			<span class="xml&#45;tag">&lt;interceptor name=<span class="xml&#45;quote">&quot;workflow&quot;</span> &#10;				class=<span class="xml&#45;quote">&quot;com.opensymphony.xwork.interceptor.DefaultWorkflowInterceptor&quot;</span>/&gt;</span>&#10;			<span class="xml&#45;tag">&lt;interceptor name=<span class="xml&#45;quote">&quot;servlet&#45;config&quot;</span> &#10;				class=<span class="xml&#45;quote">&quot;com.opensymphony.webwork.interceptor.ServletConfigInterceptor&quot;</span>/&gt;</span>&#10;			<span class="xml&#45;tag">&lt;interceptor name=<span class="xml&#45;quote">&quot;prepare&quot;</span> &#10;				class=<span class="xml&#45;quote">&quot;com.opensymphony.xwork.interceptor.PrepareInterceptor&quot;</span>/&gt;</span>&#10;			<span class="xml&#45;tag">&lt;interceptor name=<span class="xml&#45;quote">&quot;conversionError&quot;</span> &#10;				class=<span class="xml&#45;quote">&quot;com.opensymphony.webwork.interceptor.WebWorkConversionErrorInterceptor&quot;</span>/&gt;</span>&#10;			<span class="xml&#45;tag">&lt;interceptor&#45;stack name=<span class="xml&#45;quote">&quot;defaultStack&quot;</span>&gt;</span>&#10;				<span class="xml&#45;tag">&lt;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;static&#45;params&quot;</span>/&gt;</span>&#10;				<span class="xml&#45;tag">&lt;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;params&quot;</span>/&gt;</span>&#10;				<span class="xml&#45;tag">&lt;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;conversionError&quot;</span>/&gt;</span>&#10;			<span class="xml&#45;tag">&lt;/interceptor&#45;stack&gt;</span>&#10;			<span class="xml&#45;tag">&lt;interceptor&#45;stack name=<span class="xml&#45;quote">&quot;validationWorkflowStack&quot;</span>&gt;</span>&#10;				<span class="xml&#45;tag">&lt;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;defaultStack&quot;</span>/&gt;</span>&#10;				<span class="xml&#45;tag">&lt;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;validation&quot;</span>/&gt;</span>&#10;				<span class="xml&#45;tag">&lt;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;workflow&quot;</span>/&gt;</span>&#10;			<span class="xml&#45;tag">&lt;/interceptor&#45;stack&gt;</span>&#10;		<span class="xml&#45;tag">&lt;/interceptors&gt;</span>&#10;	<span class="xml&#45;tag">&lt;/package&gt;</span>&#10;<span class="xml&#45;tag">&lt;/xwork&gt;</span></pre>
</div></div></p>由于在<tt class="monospaced">xwork.xml</tt>中包含了<tt class="monospaced">webwork-default.xml</tt>, 上述全部截取器和战斗可以用于我们的活动. 下面列出这些截取器的功能:<br/>

<ul class="star">
<li> <b class="strong">timer</b>: 对活动(包含嵌套的截取器和视图)执行进行计时;</li>
<li> <b class="strong">logger</b>: 纪录将要执行的活动;</li>
<li> <b class="strong">chain</b>: 使得前一个活动的属性在当前活动中可用. 用于实现活动链(action chaining) (参阅: <a href="Result Types.html" title="Result Types">结果类型</a>);</li>
<li> <b class="strong">static-params</b>: 将<tt class="monospaced">xwork.xml</tt>中定义的参数设置到活动中. 相当于包含在<tt class="monospaced">&lt;action /&gt;</tt>标签中的<tt class="monospaced">&lt;param /&gt;</tt>标签;</li>
<li> <b class="strong">params</b>: 将请求(POST和GET)的参数设置到活动类中. 在<a href="TutorialLesson03.html" title="TutorialLesson03">第三课中有这样的例子</a>;</li>
<li> <b class="strong">model-driven</b>: 如果活动实现<tt class="monospaced">ModelDriven</tt>, 将<tt class="monospaced">getModel()</tt>的结果压入值栈;</li>
<li> <b class="strong">component</b>: 激活注册的组件并允许活动使用. (参见: <span class="error">&#91;IoC与组件&#93;</span>);</li>
<li> <b class="strong">token</b>: 在活动中检查合法令牌(token), 防止表单的重复提交;</li>
<li> <b class="strong">token-session</b>: 同上, 但是在接到非法令牌时将提交的数据保存在session中;</li>
<li> <b class="strong">validation</b>: 使用定义在<tt class="monospaced">&#123;Action&#125;-validation.xml</tt>中的校验器进行校验(参见: <a href="Validation.html" title="Validation">校验</a>). 在<a href="TutorialLesson04-01-01.html" title="TutorialLesson04-01-01">4.1.1</a>中有这样的例子;</li>
<li> <b class="strong">workflow</b>: 调用活动类中的validate方法. 如果活动产生了错误将返回到<tt class="monospaced">输入</tt>视图. 应当与校验截取器一起使用(参见: <a href="Validation.html" title="Validation">校验</a>);</li>
<li> <b class="strong">servlet-config</b>: 提供访问<tt class="monospaced">HttpServletRequest</tt>和<tt class="monospaced">HttpServletResponse</tt>的途径(使用前请三思, 因为它使你的代码与Servlet接口绑定在一起);</li>
<li> <b class="strong">prepare</b>: 允许在参数设置之前通过代码访问活动.;</li>
<li> <b class="strong">conversionError</b>: <font color="red"><em class="emphasis">此处需要帮助</em></font>.</li>
</ul><p class="paragraph"><h2 class="heading2"><a name="TutorialLesson05-BuildingyourownInterceptor"> 构建自己的截取器</a></h2></p>如果上述截取器都不符合你的特殊需要, 你需要实现自己的截取器. 幸运的是, 这是一个非常容易完成的任务. 假定我们需要一个截取器根据不同的时段(早晨, 下午或晚上)在session中放入对应的问候语. 下文展示了如何实现它: <p class="paragraph"><h3 class="heading3"><a name="TutorialLesson05-GreetingInterceptor.java%3A"> GreetingInterceptor.java:</a></h3>
<div class="code"><div class="codeContent">
<pre><span class="java&#45;keyword">package</span> lesson05;&#10;&#10;<span class="java&#45;keyword">import</span> java.util.Calendar;&#10;<span class="java&#45;keyword">import</span> com.opensymphony.xwork.interceptor.Interceptor;&#10;<span class="java&#45;keyword">import</span> com.opensymphony.xwork.ActionInvocation;&#10;&#10;<span class="java&#45;keyword">public</span> class GreetingInterceptor <span class="java&#45;keyword">implements</span> Interceptor &#123;&#10;	<span class="java&#45;keyword">public</span> void init() &#123; &#125;&#10;	<span class="java&#45;keyword">public</span> void destroy() &#123; &#125;&#10;	<span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">String</span> intercept(ActionInvocation invocation) <span class="java&#45;keyword">throws</span> Exception &#123;&#10;		Calendar calendar = Calendar.getInstance();&#10;		<span class="java&#45;object">int</span> hour = calendar.get(Calendar.HOUR&#95;OF&#95;DAY);&#10;		<span class="java&#45;object">String</span> greeting = (hour &lt; 6) &#63; <span class="java&#45;quote">&quot;Good evening&quot;</span> : &#10;			((hour &lt; 12) &#63; <span class="java&#45;quote">&quot;Good morning&quot;</span>: &#10;			((hour &lt; 18) &#63; <span class="java&#45;quote">&quot;Good afternoon&quot;</span>: <span class="java&#45;quote">&quot;Good evening&quot;</span>));&#10;&#10;		invocation.getInvocationContext().getSession().put(<span class="java&#45;quote">&quot;greeting&quot;</span>, greeting);&#10;&#10;		<span class="java&#45;object">String</span> result = invocation.invoke();&#10;&#10;		<span class="java&#45;keyword">return</span> result;&#10;	&#125;&#10;&#125;</pre>
</div></div></p><h3 class="heading3"><a name="TutorialLesson05-xwork.xml%3A"> xwork.xml:</a></h3>
<div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;&#33;DOCTYPE xwork PUBLIC <span class="xml&#45;quote">&quot;&#45;//OpenSymphony Group//XWork 1.0//EN&quot;</span> &#10;<span class="xml&#45;quote">&quot;&#104;ttp://www.opensymphony.com/xwork/xwork&#45;1.0.dtd&quot;</span>&gt;</span>&#10;&#10;<span class="xml&#45;tag">&lt;xwork&gt;</span>&#10;	<span class="xml&#45;tag"><span class="xml&#45;comment">&lt;&#33;&#45;&#45; Include webwork defaults (from WebWork JAR). &#45;&#45;&gt;</span></span>&#10;	<span class="xml&#45;tag">&lt;include file=<span class="xml&#45;quote">&quot;webwork&#45;default.xml&quot;</span> /&gt;</span>&#10;	&#10;	<span class="xml&#45;tag"><span class="xml&#45;comment">&lt;&#33;&#45;&#45; Configuration for the default package. &#45;&#45;&gt;</span></span>&#10;	<span class="xml&#45;tag">&lt;package name=<span class="xml&#45;quote">&quot;default&quot;</span> extends=<span class="xml&#45;quote">&quot;webwork&#45;default&quot;</span>&gt;</span>&#10;		<span class="xml&#45;tag">&lt;interceptors&gt;</span> &#10;			<span class="xml&#45;tag">&lt;interceptor name=<span class="xml&#45;quote">&quot;greeting&quot;</span> class=<span class="xml&#45;quote">&quot;section02.lesson05.GreetingInterceptor&quot;</span> /&gt;</span> &#10;		<span class="xml&#45;tag">&lt;/interceptors&gt;</span> &#10;		&#10;		<span class="xml&#45;tag"><span class="xml&#45;comment">&lt;&#33;&#45;&#45; Action: Lesson 5: GreetingInterceptor. &#45;&#45;&gt;</span></span> &#10;		<span class="xml&#45;tag">&lt;action name=<span class="xml&#45;quote">&quot;greetingAction&quot;</span> class=<span class="xml&#45;quote">&quot;lesson05.GreetingAction&quot;</span>&gt;</span> &#10;			<span class="xml&#45;tag">&lt;result name=<span class="xml&#45;quote">&quot;success&quot;</span> type=<span class="xml&#45;quote">&quot;velocity&quot;</span>&gt;</span>ex01&#45;result.vm<span class="xml&#45;tag">&lt;/result&gt;</span> &#10;			<span class="xml&#45;tag">&lt;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;greeting&quot;</span> /&gt;</span> &#10;		<span class="xml&#45;tag">&lt;/action&gt;</span> &#10;	<span class="xml&#45;tag">&lt;/package&gt;</span>&#10;<span class="xml&#45;tag">&lt;/xwork&gt;</span></pre>
</div></div><p class="paragraph"><h3 class="heading3"><a name="TutorialLesson05-GreetingAction.java%3A"> GreetingAction.java:</a></h3>
<div class="code"><div class="codeContent">
<pre><span class="java&#45;keyword">package</span> lesson05;&#10;&#10;<span class="java&#45;keyword">import</span> com.opensymphony.xwork.ActionSupport;&#10;&#10;<span class="java&#45;keyword">public</span> class GreetingAction <span class="java&#45;keyword">extends</span> ActionSupport &#123;&#10;	<span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">String</span> execute() <span class="java&#45;keyword">throws</span> Exception &#123;&#10;		<span class="java&#45;keyword">return</span> SUCCESS;&#10;	&#125;&#10;&#125;</pre>
</div></div></p><h3 class="heading3"><a name="TutorialLesson05-ex01result.vm%3A"> ex01-result.vm:</a></h3>
<div class="code"><div class="codeContent">
<pre>&lt;html&gt;&#10;&lt;head&gt;&#10;&lt;title&gt;WebWork Tutorial &#45; Lesson 5 &#45; Example 1&lt;/title&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;&#10;#set ($ses = $req.getSession())&#10;&lt;p&gt;&lt;b&gt;$&#123;ses.getAttribute(&#039;greeting&#039;)&#125;&#33;&lt;/b&gt;&lt;/p&gt;&#10;&#10;&lt;/body&gt;&#10;&lt;/html&gt;</pre>
</div></div><p class="paragraph">先来看一下截取器类. 和之前介绍的一样, 截取器必须实现<tt class="monospaced">com.opensymphony.xwork.interceptor.Interceptor</tt>的方法: <tt class="monospaced">init()</tt>, 将在初始化时被调用, <tt class="monospaced">destroy()</tt>, 在销毁时被调用, 最为重要, <tt class="monospaced">intercept(ActionInvocation invocation)</tt>, 该方法是加入工作代码的地方.</p>注意, 我们的截取器返回<tt class="monospaced">invocation.invoke()</tt>的结果, 该方法将执行栈中下一个截取器, 如果本截取器是栈中的最后一个, 将执行活动. 这意味着截取器有短路(short-circuiting)活动调用的能力, 可以根本不执行活动直接返回一个String结果! 这种用法需要谨慎使用.<p class="paragraph">截取器的另一个功能是在活动执行后执行代码. 为此, 只需将代码放在invocation.invoke()调用之后. WebWork提供一个已经实现下列行为的抽象类: <tt class="monospaced">com.opensymphony.xwork.interceptor.AroundInterceptor</tt>. 只须继承(extend)该类并实现方法<tt class="monospaced">before(ActionInvocation invocation)</tt>和<tt class="monospaced">after(ActionInvocation dispatcher, String result)</tt>.</p><tt class="monospaced">xwork.xml</tt>中关于活动类和结果页面的配置内容简洁明了不需要进一步解释.<br/>

<blockquote class="blockquote"> <a href="TutorialExamples.html" title="TutorialExamples">试试这个例子!</a></blockquote>
<p class="paragraph"><hr class="line"/></p><a href="TutorialLesson04.html" title="TutorialLesson04">上一课</a> | <a href="TutorialEnd.html" title="TutorialEnd">指南结束</a><br/>



				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="border/border_bottom.gif"><img src="border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Dec 14, 2004 16:36</font></td>
		    </tr>
	    </table>
    </body>
</html>