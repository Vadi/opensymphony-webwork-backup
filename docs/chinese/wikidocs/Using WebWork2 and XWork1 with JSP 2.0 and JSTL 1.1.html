<html>
    <head>
        <title>WebWork 2 : Using WebWork2 and XWork1 with JSP 2.0 and JSTL 1.1</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            WebWork 2 : Using WebWork2 and XWork1 with JSP 2.0 and JSTL 1.1
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Nov 30, 2004 by <font color="#0050B2">jcarreira</font>.
				    </div>

				    <p class="paragraph">WW2/WX1 and its taglib is oriented towards OGNL, which is using a value stack <br/>
for all action properties. These values are not direct available for the<br/>
expression language of JSP2/JSTL1.1.</p>However, it&#039;s easy to populate the request<br/>
attribute set, with all gettable properties of an action object. You need to provide<br/>
an interceptor that does the job, by register a PreResultListener which is <br/>
invoked after the return of Action.execute() but before the rendering of the result .<p class="paragraph">The interceptor below is using Jakarta BeanUtils. It first extracts all getters<br/>
of the current action, invokes them one at the time and stores the values into a map.<br/>
Then it iterates over the map and populates the request attribute set.<br/>
<em class="emphasis">The double iteration is not needed, it&#039;s just there for clarity.</em>
<h2 class="heading2"><a name="UsingWebWork2andXWork1withJSP2.0andJSTL1.1-classActionPropertyExportInterceptor"> class ActionPropertyExportInterceptor</a></h2>
<div class="code"><div class="codeContent">
<pre><span class="java&#45;keyword">package</span> com.whatever.interceptors;&#10;&#10;<span class="java&#45;keyword">import</span> com.opensymphony.webwork.WebWorkStatics;&#10;<span class="java&#45;keyword">import</span> com.opensymphony.xwork.Action;&#10;<span class="java&#45;keyword">import</span> com.opensymphony.xwork.ActionInvocation;&#10;<span class="java&#45;keyword">import</span> com.opensymphony.xwork.interceptor.AroundInterceptor;&#10;<span class="java&#45;keyword">import</span> com.opensymphony.xwork.interceptor.PreResultListener;&#10;<span class="java&#45;keyword">import</span> org.apache.commons.beanutils.PropertyUtils;&#10;<span class="java&#45;keyword">import</span> javax.servlet.http.HttpServletRequest;&#10;<span class="java&#45;keyword">import</span> java.beans.PropertyDescriptor;&#10;<span class="java&#45;keyword">import</span> java.util.&#42;;&#10;&#10;/&#42;&#42;&#10; &#42; Populates HTTP Request Attributes with all gettable properties of the current action.&#10; &#42;/&#10;<span class="java&#45;keyword">public</span> class ActionPropertyExportInterceptor <span class="java&#45;keyword">extends</span> AroundInterceptor &#123;&#10;    <span class="java&#45;keyword">protected</span> void before(ActionInvocation invocation) <span class="java&#45;keyword">throws</span> Exception &#123;&#10;        invocation.addPreResultListener( <span class="java&#45;keyword">new</span> PropertyExporter() );&#10;    &#125;&#10;    <span class="java&#45;keyword">protected</span> void after(ActionInvocation dispatcher, <span class="java&#45;object">String</span> result) <span class="java&#45;keyword">throws</span> Exception &#123; &#125;&#10;&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;keyword">static</span> class PropertyExporter <span class="java&#45;keyword">implements</span> PreResultListener &#123;&#10;        <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;keyword">static</span>&#160;<span class="java&#45;keyword">final</span> List   ignore = Arrays.asList(<span class="java&#45;keyword">new</span>&#160;<span class="java&#45;object">String</span>&#91;&#93; &#123;<span class="java&#45;quote">&quot;class&quot;</span>, <span class="java&#45;quote">&quot;texts&quot;</span>&#125;); <span class="java&#45;comment">//skip getClass,...</span>&#10;&#10;        <span class="java&#45;comment">//Invoked after Action.execute() but before Result</span>&#10;        <span class="java&#45;comment">//Calls all getters of the action and insert the values into the request</span>&#10;        <span class="java&#45;keyword">public</span> void beforeResult(ActionInvocation invocation, <span class="java&#45;object">String</span> resultCode) &#123;&#10;            Map                 props   = extractGetterPropertyValues( invocation.getAction() );&#10;            HttpServletRequest  request = getRequest(invocation);&#10;            <span class="java&#45;keyword">for</span> (Iterator it = props.entrySet().iterator(); it.hasNext()&#59;&#41; &#123;&#10;                Map.Entry   e = (Map.Entry) it.next();&#10;                request.setAttribute((<span class="java&#45;object">String</span>) e.getKey(), e.getValue());&#10;            &#125;&#10;        &#125;&#10;&#10;        <span class="java&#45;keyword">public</span> Map extractGetterPropertyValues(<span class="java&#45;object">Object</span> bean) &#123;&#10;            PropertyDescriptor&#91;&#93;  descr = PropertyUtils.getPropertyDescriptors(bean);&#10;            Map                   props = <span class="java&#45;keyword">new</span> HashMap();&#10;            <span class="java&#45;keyword">for</span> (<span class="java&#45;object">int</span> i = 0; i &lt; descr.length; i&#43;&#43;) &#123;&#10;                PropertyDescriptor d = descr&#91;i&#93;;&#10;                <span class="java&#45;keyword">if</span> (d.getReadMethod() == <span class="java&#45;keyword">null</span>) <span class="java&#45;keyword">continue</span>;&#10;                <span class="java&#45;keyword">if</span> (ignore.contains(d.getName())) <span class="java&#45;keyword">continue</span>;&#10;&#10;                <span class="java&#45;keyword">try</span> &#123;&#10;                    props.put(d.getName(), PropertyUtils.getProperty(bean, d.getName()));&#10;                &#125; <span class="java&#45;keyword">catch</span> (Exception e) &#123; &#125;&#10;            &#125;&#10;            <span class="java&#45;keyword">return</span> props;&#10;        &#125;&#10;&#10;        <span class="java&#45;keyword">public</span> HttpServletRequest getRequest(ActionInvocation invocation) &#123;&#10;            <span class="java&#45;keyword">return</span> (HttpServletRequest) invocation.getInvocationContext().get(WebWorkStatics.HTTP&#95;REQUEST);&#10;        &#125;&#10;    &#125;&#10;&#125;</pre>
</div></div></p>Don&#039;t forget to <em class="emphasis">declare</em> the interceptor in your xwork.xml file and <em class="emphasis">insert</em> it <br/>
into your interceptor stack.
<h2 class="heading2"><a name="UsingWebWork2andXWork1withJSP2.0andJSTL1.1-xwork.xmlsnippet"> xwork.xml snippet</a></h2>
<div class="code"><div class="codeContent">
<pre>&lt;interceptor name=<span class="java&#45;quote">&quot;export&quot;</span> class=<span class="java&#45;quote">&quot;com.whatever.interceptors.ActionPropertyExportInterceptor&quot;</span> /&gt;&#10;. . .&#10;&lt;interceptor&#45;stack name=<span class="java&#45;quote">&quot;standard&#45;interceptors&quot;</span>&gt;&#10;    &lt;interceptor&#45;ref name=<span class="java&#45;quote">&quot;timer&quot;</span> /&gt;&#10;    &lt;interceptor&#45;ref name=<span class="java&#45;quote">&quot;logger&quot;</span> /&gt;&#10;    &lt;interceptor&#45;ref name=<span class="java&#45;quote">&quot;params&quot;</span> /&gt;&#10;&#42;    &lt;interceptor&#45;ref name=<span class="java&#45;quote">&quot;export&quot;</span>/&gt;&#42;&#10;    &lt;interceptor&#45;ref name=<span class="java&#45;quote">&quot;validateParams&quot;</span>/&gt;&#10;    &lt;interceptor&#45;ref name=<span class="java&#45;quote">&quot;awarePlugger&quot;</span> /&gt;&#10;&lt;/interceptor&#45;stack&gt;</pre>
</div></div><p class="paragraph">Your action need to provide getters for all properties that should be exported into the <br/>
request attribute set.
<h2 class="heading2"><a name="UsingWebWork2andXWork1withJSP2.0andJSTL1.1-classViewUser"> class ViewUser</a></h2>
<div class="code"><div class="codeContent">
<pre><span class="java&#45;keyword">public</span> class ViewUser <span class="java&#45;keyword">extends</span> ActionSupport &#123;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">int</span>                         id;&#10;    <span class="java&#45;keyword">private</span> User                        user;&#10;&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">String</span> execute() <span class="java&#45;keyword">throws</span> Exception &#123;&#10;        user = findUser( getId() );&#10;        <span class="java&#45;keyword">return</span> Action.SUCCESS;&#10;    &#125;&#10;&#10;    <span class="java&#45;keyword">public</span>  <span class="java&#45;object">int</span>   getId()          &#123;<span class="java&#45;keyword">return</span> id;&#125;&#10;    <span class="java&#45;keyword">public</span>  void  setId(<span class="java&#45;object">int</span> id)    &#123;<span class="java&#45;keyword">this</span>.id = id;&#125;&#10;&#42;    <span class="java&#45;keyword">public</span>  User  getUser()        &#123;<span class="java&#45;keyword">return</span> user;&#125;&#42;&#10;&#10;    <span class="java&#45;keyword">private</span> User  findUser(<span class="java&#45;object">int</span> id) &#123;...&#125;&#10;&#125;</pre>
</div></div></p>The User class might look like this
<h2 class="heading2"><a name="UsingWebWork2andXWork1withJSP2.0andJSTL1.1-classUser"> class User</a></h2>
<div class="code"><div class="codeContent">
<pre><span class="java&#45;keyword">import</span> java.util.Date;&#10;<span class="java&#45;keyword">public</span> class User &#123;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">int</span>     id;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">String</span>  firstName, lastName, email;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">String</span>  street, zip, city;&#10;    <span class="java&#45;keyword">private</span> Date    date;&#10;    &#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">String</span>  getFirstName() &#123;<span class="java&#45;keyword">return</span> firstName;&#125;&#10;    <span class="java&#45;comment">//...&#95;getters and setters&#95;...</span>&#10;&#125;</pre>
</div></div><p class="paragraph">Finally, using the samples above you can write your JSP2 page like this.
<h2 class="heading2"><a name="UsingWebWork2andXWork1withJSP2.0andJSTL1.1-ViewUser.jsp"> ViewUser.jsp</a></h2>
<div class="code"><div class="codeContent">
<pre>&lt;&#37;&#64; taglib prefix=<span class="java&#45;quote">&quot;c&quot;</span>   uri=<span class="java&#45;quote">&quot;http:<span class="java&#45;comment">//java.sun.com/jsp/jstl/core&quot;</span> &#37;&gt;</span>&#10;&lt;&#37;&#64; taglib prefix=<span class="java&#45;quote">&quot;fmt&quot;</span> uri=<span class="java&#45;quote">&quot;http:<span class="java&#45;comment">//java.sun.com/jsp/jstl/fmt&quot;</span> &#37;&gt;</span>&#10;&lt;&#37;&#64; taglib prefix=<span class="java&#45;quote">&quot;fn&quot;</span>  uri=<span class="java&#45;quote">&quot;http:<span class="java&#45;comment">//java.sun.com/jsp/jstl/functions&quot;</span> &#37;&gt;</span>&#10;&lt;html&gt;&#10;&lt;head&gt;&#10;    &lt;title&gt;Info about $&#123;user.firstName&#125;&lt;/title&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;    &lt;h1&gt;Info about $&#123;user.firstName&#125; $&#123;user.lastName&#125; &#91;OS:ID=$&#123;user.id&#125;&#93;&lt;/h1&gt;&#10;    &lt;table border=<span class="java&#45;quote">&quot;1&quot;</span> cellspacing=<span class="java&#45;quote">&quot;0&quot;</span> cellpadding=<span class="java&#45;quote">&quot;2&quot;</span> width=<span class="java&#45;quote">&quot;90&#37;&quot;</span> &gt;&#10;    &lt;tr&gt;&#10;        &lt;th&gt;Name&lt;/th&gt; &lt;td&gt;$&#123;user.firstName&#125; $&#123;user.lastName&#125;&lt;/td&gt;&#10;    &lt;/tr&gt;&#10;    &lt;tr&gt;&#10;        &lt;th&gt;Created&lt;/th&gt; &lt;td&gt;&lt;fmt:formatDate value=<span class="java&#45;quote">&quot;$&#123;user.date&#125;&quot;</span> pattern=<span class="java&#45;quote">&quot;yyyy&#45;MM&#45;dd HH:mm&quot;</span>/&gt;&lt;/td&gt;&#10;    &lt;/tr&gt;&#10;    &lt;tr&gt;&#10;        &lt;th&gt;Email&lt;/th&gt; &lt;td&gt;$&#123;user.email&#125;&lt;/td&gt;&#10;    &lt;/tr&gt;&#10;    &lt;tr&gt;&#10;        &lt;th&gt;Address&lt;/th&gt; &lt;td&gt;$&#123;user.street&#125; $&#123;user.zip&#125; $&#123;fn:toUpperCase(user.city)&#125;&lt;/td&gt;&#10;    &lt;/tr&gt;&#10;    &lt;/table&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;</pre>
</div></div></p>

				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="border/border_bottom.gif"><img src="border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Dec 14, 2004 16:36</font></td>
		    </tr>
	    </table>
    </body>
</html>