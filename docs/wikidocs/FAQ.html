<html>
    <head>
        <title>WebWork - 
        FAQ
         </title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="information-block" align='center'><div class='informationMacroPadding'><table cellpadding='5' width='85%' cellspacing='0' class='noteMacro' border='0'><tr><td width='16' valign='top'><img src="/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Each question should be a new page. Typically answers should link to content in the <a href="Reference.html" title="Reference">Reference</a>. If the answer isn't in the <a href="Reference.html" title="Reference">Reference</a>, then it should probably be added there and then linked to from the FAQ. Also note that some of the questions are current'y too verbose and should be broken down given that they have already been categorized (ie: Validation, Internationlization, etc).</td></tr></table></div></div>

<p>General</p>

<ul>
	<li><a href="How do I get the latest version of WebWork.html" title="How do I get the latest version of WebWork">How do I get the latest version of WebWork</a></li>
	<li>What are the default variables in the value stack</li>
	<li>How do I get access to the session</li>
	<li>How can I see all parameters passed into the action</li>
	<li>How can I get the HttpServletRequest</li>
	<li>Can I break up my large XWork.xml file into smaller pieces</li>
	<li>I'm trying to run the webwork example in the tutorial on Tomcat, and it can't instantiate the VelocityEngine</li>
</ul>


<p>Tags</p>

<ul>
	<li>How can I put a String literal in a Javascript call, for instance in an onChange attribute</li>
	<li>Why won't the 'if' tag evaluate a one char string</li>
</ul>


<p>Inversion of Control</p>

<ul>
	<li>How can I integrate WebWork IoC in to an object that is not an action</li>
</ul>


<p>Validation </p>

<ul>
	<li>How do I use messages from within the validator</li>
</ul>


<p>Internationalization</p>

<ul>
	<li>How do I set a global resource bundle?</li>
	<li>How do I decouple XWork LocalizedTextUtil global resource bundle loading from serlvets</li>
	<li>How do I add I18N to a UI tag, like the textfield tag</li>
	<li>Can I add I18N outside the Action's context</li>
</ul>


<p>Type Conversion</p>

<ul>
	<li>How do I change the error message for invalid inputted fields</li>
</ul>


<hr />

<p><b>What are the default variables in the value stack? (accessible using #foo)</b><br/>
attr (scans the request, session, and application attributes, in that order)<br/>
request (request attributes)<br/>
session (session attributes)<br/>
application (application attributes)<br/>
parameters (request params)</p>

<p><b>How do I get the latest version of Webwork and XWork from CVS?</b><br/>
cvs -d :pserver:guest@cvs.dev.java.net:/cvs login<br/>
(Use an empty password, just hit enter..)<br/>
cvs -d :pserver:guest@cvs.dev.java.net:/cvs checkout webwork<br/>
cvs -d :pserver:guest@cvs.dev.java.net:/cvs checkout xwork</p>

<p>Note: WebWork from the CVS does not compile with the latest 1.5 J2sdk. Use the stable J2sdk 1.4.2.</p>

<p><b>How do I build the latest versions XWork and Webwork?</b><br/>
Just go into the XWork or WebWork directories and run 'ant' (you must have ant installed and have the jars of junit and clover inside $ANT_HOME/lib)</p>

<p>Once you have built the xwork.jar copy it into the webwork/lib/core folder, and delete the old one.</p>

<p><b>How do I use messages from within the validator?</b></p>
<div class="code"><div class="codeContent">
<pre class="code-xml"><span class="code-tag">&lt;validators&gt;</span>
    <span class="code-tag">&lt;field name=<span class="code-quote">"name"</span>&gt;</span>
        <span class="code-tag">&lt;field-validator type=<span class="code-quote">"requiredstring"</span>&gt;</span>
            <span class="code-tag">&lt;message key=<span class="code-quote">"template.name.errors.required"</span>&gt;</span>A default message in case the key is not found<span class="code-tag">&lt;/message&gt;</span>
        <span class="code-tag">&lt;/field-validator&gt;</span>
    <span class="code-tag">&lt;/field&gt;</span>
<span class="code-tag">&lt;/validators&gt;</span></pre>
</div></div>

<p><b>How do I set a global resource bundle?</b></p>

<p>In webwork.properties(as of Webwork 2.1.1), <br/>
you can now use:</p>
<div class="code"><div class="codeContent">
<pre class="code-java">webwork.custom.i18n.resources=global-messages</pre>
</div></div>
<p>Serveral resource bundles can be specified by comma separating them.<br/>
for example see webwork.properties :<br/>
<a href="http://wiki.opensymphony.com/display/WW/webwork.properties" title="Visit page outside Confluence">&#104;ttp://wiki.opensymphony.com/display/WW/webwork.properties</a></p>

<p>Java class (thanks Drew McAuliffe):</p>
<div class="code"><div class="codeContent">
<pre class="code-java"><span class="code-keyword">public</span> class WebworkGlobalMessagesListener <span class="code-keyword">implements</span> ServletContextListener {
    <span class="code-keyword">private</span> <span class="code-keyword">static</span> Logger log = Logger.getLogger(WebworkGlobalMessagesListener.class);
    <span class="code-keyword">private</span> <span class="code-keyword">static</span> <span class="code-keyword">final</span> <span class="code-object">String</span> DEFAULT_RESOURCE = <span class="code-quote">"global-messages"</span>;

    /**
     * Uses the LocalizedTextUtil to load messages from the global
     message bundle.
     * @see
     javax.servlet.ServletContextListener#contextInitialized(javax.servlet.Servle
     tContextEvent)
     */
    <span class="code-keyword">public</span> void contextInitialized(ServletContextEvent arg0) {
        log.info(<span class="code-quote">"Loading global messages from "</span> + DEFAULT_RESOURCE);
        LocalizedTextUtil.addDefaultResourceBundle(DEFAULT_RESOURCE);
        log.info(<span class="code-quote">"Global messages loaded."</span>);
    }

    /**
     * @see javax.servlet.ServletContextListener#contextDestroyed(javax.servlet.ServletContextEvent)
     */
    <span class="code-keyword">public</span> void contextDestroyed(ServletContextEvent arg0) {

        <span class="code-comment">// <span class="code-keyword">do</span> nothing
</span>    }

}</pre>
</div></div>
<p>web.xml:<br/>
(under listeners section)</p>
<div class="code"><div class="codeContent">
<pre class="code-xml"><span class="code-tag">&lt;listener&gt;</span>
<span class="code-tag">&lt;listener-class&gt;</span>mypackagename.WebworkGlobalMessagesListener<span class="code-tag">&lt;/listener-class&gt;</span>
<span class="code-tag">&lt;/listener&gt;</span></pre>
</div></div>

<p><b>How do I change the error message for invalid inputted fields?</b><br/>
You need to create a message for that field, for example if you have a user.dob field you would use this in your messages file (see above for example on setting a global messages file): <br/>
invalid.fieldvalue.user.dob=Please enter Date of Birth in the correct format.</p>

<p><b>How do I get access to the Session?</b><br/>
ActionContext.getContext().getSession() (returns Map, works internally using a ThreadLocal)</p>

<p><b>How can I see all parameters passed into the Action?</b><br/>
ActionContext.getParameters() (returns Map, works internally using a ThreadLocal)</p>

<p><b>How can I get the HttpServletRequest?</b><br/>
ServletActionContext.getRequest() (works internally using a ThreadLocal)</p>

<p><b>How can I use the IOC container to initialize a component in another object that isnt an action?</b><br/>
Obtain the ComponentManager from the request: ComponentManager cm = (ComponentManager) ServletActionContext.getRequest().getAttribute("DefaultComponentManager");<br/>
then you need to initialize it using: cm.initializeObject(Object)</p>

<p><b>How do I decouple XWork LocalizedTextUtil global resource bundle loading from serlvets (ServletContextListener)?</b><br/>
If you're using XWork outside a Web context, then use whatever startup hooks you have in that context (i.e. application start for a desktop app) to add the global resource bundle. This is a startup activity, so use whatever mechanisms are provided in the context you're running in.</p>

<p><b>What i need to do to put values in a combobox. If I am using webwork2?</b><br/>
If i have :</p>
<div class="code"><div class="codeContent">
<pre class="code-java">#tag(Select <span class="code-quote">"label='xxx '"</span> <span class="code-quote">"name='xxx'"</span> <span class="code-quote">"list=?"</span>)
or 
#tag(combobox <span class="code-quote">"label='Prioridade'"</span> <span class="code-quote">"name='inavis.avisTpPrioridade'"</span> <span class="code-quote">"list=?"</span>)</pre>
</div></div>
<p>the values in this combobox, what i need to do?<br/>
Exemple:</p>
<div class="code"><div class="codeContent">
<pre class="code-java">html tag i use to <span class="code-keyword">do</span>:

&lt;select..&gt;
  &lt;otpion value="" selected&gt;XXX&lt;/option&gt;
&lt;/selct&gt;</pre>
</div></div>
<p>so...i need to do this using Webwork tags from Velocity...how can i do this??</p>

<p><b>How do I add I18N to a UI tag, like ww:textfield?</b></p>
<div class="code"><div class="codeContent">
<pre class="code-java">&lt;ww:textfield label=<span class="code-quote">"'i18n.label'"</span> name=<span class="code-quote">"'label1'"</span> value=<span class="code-quote">"''"</span>&gt;</pre>
</div></div>
<p>This will get the localized text message for the key "i18n.label" and put it in the label.</p>
<div class="code"><div class="codeContent">
<pre class="code-java">&lt;ww:textfield label=<span class="code-quote">"getText('i18n.label')"</span> name=<span class="code-quote">"'label1'"</span> value=<span class="code-quote">"''"</span>&gt;</pre>
</div></div>

<p>Alternatively, you could modify controlheader.vm and copy it to /template/xhtml. There you could make it so that it automatically does a call to $stack.findValue("getText($parameters.label)"), making the first example actually work for i18n.</p>

<p><b>Can I add I18N outside the Action's context? i.e. adding i18n to some JSP using the ww taglib?</b><br/>
Yes, use the &lt;ww:i18n&gt; tag to push a resource bundle on to the stack. Now calls with &lt;ww:text/&gt; or &lt;ww:property value="getText(...)"/&gt; will read from that resource bundle.</p>

<p><b>Can I break up my large XWork.xml file into smaller pieces?</b><br/>
Sure, that's what the &lt;include&gt; element is for. Most xwork.xml files<br/>
already have one: </p>

<div class="code"><div class="codeContent">
<pre class="code-java">&lt;xwork&gt;
    &lt;include file=<span class="code-quote">"webwork-<span class="code-keyword">default</span>.xml"</span>/&gt;
    &lt;include file=<span class="code-quote">"config-browser.xml"</span>/&gt;
    &lt;<span class="code-keyword">package</span> name=<span class="code-quote">"<span class="code-keyword">default</span>"</span> <span class="code-keyword">extends</span>=<span class="code-quote">"webwork-<span class="code-keyword">default</span>"</span>&gt;
....
    &lt;/<span class="code-keyword">package</span>&gt;
    &lt;include file=<span class="code-quote">"other.xml"</span>/&gt;
&lt;/xwork&gt;</pre>
</div></div>

<p>This tells it to load the webwork-default.xml from the webwork jar file<br/>
to get all of those interceptor and result definitions. </p>

<p>You can put your own &lt;include&gt; in your xwork.xml interchangeably with<br/>
&lt;package&gt; elements... They will be loaded in the same order as it reads<br/>
from top to bottom and adds things as it reads them.</p>

<p><b>How can I put a String literal in a Javascript call, for instance in an onChange attribute?</b></p>

<p>The problem is in escaping quotes and getting the double quotes around the final value, like we expect  in HTML attributes. Here's an example of the right way to do this (thanks to John Brad):</p>

<div class="code"><div class="codeContent">
<pre class="code-java">onchange='<span class="code-quote">"someFunc(<span class="code-keyword">this</span>.form, \'abc\')"</span>'</pre>
</div></div>

<p>Notice here that there are single quotes surrounding the double quotes, and then the single quotes inline in the Javascript are escaped. This produces this result:</p>

<div class="code"><div class="codeContent">
<pre class="code-java">onchange=<span class="code-quote">"someFunc(<span class="code-keyword">this</span>.form, 'abc')"</span></pre>
</div></div>

<p><b>Why won't the 'if' tag evaluate a one char string?</b></p>
<div class="code"><div class="codeContent">
<pre class="code-java">&lt;ww:<span class="code-keyword">if</span> test=<span class="code-quote">"#myObj.myString == 'A'"</span>&gt;
Why doesn't <span class="code-keyword">this</span> work when myString is equal to A?
&lt;/ww:<span class="code-keyword">if</span>&gt;</pre>
</div></div>

<p>OGNL will interpret 'A' as a char type and not a string.  Simple solution - flip the double and single quotes.</p>
<div class="code"><div class="codeContent">
<pre class="code-java">&lt;ww:<span class="code-keyword">if</span> test='#myObj.myString == <span class="code-quote">"A"</span>'&gt;
This works!
&lt;/ww:<span class="code-keyword">if</span>&gt;</pre>
</div></div>

<p>Alternatively, you can escape the double quotes in the String:</p>

<div class="code"><div class="codeContent">
<pre class="code-java">&lt;ww:<span class="code-keyword">if</span> test=<span class="code-quote">"#myObj.myString == \"</span>A\""&gt;
This works!
&lt;/ww:<span class="code-keyword">if</span>&gt;</pre>
</div></div>

<p><b>I'm trying to run the webwork example in the tutorial on Tomcat, and it can't instantiate the VelocityEngine</b></p>

<p>Tomcat says:</p>

<p>javax.servlet.ServletException: Servlet.init() for servlet webwork threw exception at <br/>
org.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.java:963)<br/>
...<br/>
root cause</p>

<p>java.lang.RuntimeException: Unable to instantiate VelocityEngine!<br/>
	at <br/>
com.opensymphony.webwork.views.velocity.VelocityManager.newVelocityEngine(VelocityManager.java:333)<br/>
	at <br/>
com.opensymphony.webwork.views.velocity.VelocityManager.init(VelocityManager.java:146)<br/>
	at <br/>
com.opensymphony.webwork.dispatcher.ServletDispatcher.init(ServletDispatcher.java:177)<br/>
	at <br/>
org.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.java:935)</p>


<p><em>Solution:</em> <b>(thanks to Keith Lea)</b></p>

<p>It turns out Velocity's Avalon logging system was trying to write to my tomcat folder.</p>

<p>So that it's on file somewhere for other people, I will describe the solution:</p>

<p>I created a file "velocity.properties" and placed it in my WEB-INF/classes folder. Inside the file I wrote:</p>

<p>runtime.log.logsystem.class=org.apache.velocity.runtime.log.NullLogSystem</p>

<p>This stops velocity from logging, and makes webwork work again.</p>

                    			    </td>
		    </tr>
	    </table>
    </body>
</html>
