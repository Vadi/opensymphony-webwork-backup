<html>
    <head>
        <title>WebWork - 
        Resources Available to Velocity Views
         </title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <h3><a name="ResourcesAvailabletoVelocityViews-Summary">Summary</a></h3>
<p>Here's the quick summary of the references available to Velocity templates that are kicked-off from WebWork:</p>

<ul>
	<li>$actionInstanceVariable</li>
	<li>$req - the current HttpServletRequest</li>
	<li>$res - the current HttpServletResponse</li>
	<li>$stack - the current OgnlValueStack</li>
	<li>$ognl - an OgnlTool</li>
	<li>$webwork - an instance of WebWorkUtil</li>
	<li>$action - the current WebWork action</li>
	<li>$taglib (or something like that) - access to the JSP tag library via Velocity macros (!!)</li>
</ul>


<h3><a name="ResourcesAvailabletoVelocityViews-Detail">Detail</a></h3>
<p><br clear="all" />
<b>$actionInstanceVariable</b><br/>
Each of your action class instance variables (for which you've written a getter method) are available in your Velocity template as $actionInstanceVariableName.</p>

<p>In other words, if you have an instance variable in your Action class:</p>
<div class="code"><div class="codeContent">
<pre class="code-java"><span class="code-keyword">public</span> class ProcessEditTableRowAction <span class="code-keyword">extends</span> ActionSupport {
  <span class="code-keyword">private</span> <span class="code-object">String</span> fooString;</pre>
</div></div>

<p>And you have a getter method for that string (in that same ActionClass):</p>

<div class="code"><div class="codeContent">
<pre class="code-java"><span class="code-keyword">public</span> <span class="code-object">String</span> getFooString() { <span class="code-keyword">return</span> fooString; }</pre>
</div></div>

<p>Then in your Velocity template you can retrieve the value of that String by simply refering to:</p>
<div class="code"><div class="codeContent">
<pre class="code-java">$fooString</pre>
</div></div>

<p>Note: For the most part you don't have to worry about lettercase.  If your Velocity reference is $fooString (note the lowercase "f" in foo) and your getter method is called getFooString (note uppercase "F" in foo) then WebWork does the "right thing" and uses getFooString() to retrieve the value of $fooString.</p>

<p>But things can get weird is some circumstances.  <em>TODO:</em> At least I think they can get weird.  At one point, I remember having a problem with the lettercase of Velocity variable names and the corresponding getter methods that was being used to lookup the value.  But I can't remember exactly how the problem manifested so can't provide an example.  Need to do that.</p>

<p><em>TODO:</em> I'm curious what takes care of translating the $variableName references to method calls on the Action object's getters.  Where does that happen?</p>

<p><br clear="all" />
<b>$req</b><br/>
The current HttpServletRequest created and managed by your Servlet environment (Tomcat, Resin, etc.). </p>

<p><br clear="all" />
<b>$res</b><br/>
The current HttpServletResponse created and managed by your Servlet environment (Tomcat, Resin, etc.). </p>

<p><br clear="all" />
<b>$stack</b><br/>
The OGNL value stack. (<a href="http://www.opensymphony.com/xwork/api/com/opensymphony/xwork/util/OgnlValueStack.html" title="Visit page outside Confluence">API Docs</a>)</p>

<p><em>TODO:</em> Talk about what's actually <b>on</b> the stack.  Doesn't do a whole lot of good to know it's there without knowing what's on it.</p>

<p><br clear="all" />
<b>$ognl</b><br/>
A reference to an OGNL tool. (<a href="http://www.opensymphony.com/webwork/api/com/opensymphony/webwork/views/jsp/ui/OgnlTool.html" title="Visit page outside Confluence">API Docs</a>)<br/>
([See OGNL Basics|<br/>
<a href="http://wiki.opensymphony.com/display/XW/Ognl" title="Visit page outside Confluence">&#104;ttp://wiki.opensymphony.com/display/XW/Ognl</a>])</p>


<p>At the time of this writing, there are no docs for that object, so if you really want to know how it works, be a <a href="http://en.wikipedia.org/wiki/Jedi" title="Visit page outside Confluence">Jedi</a> and "use the source".  (The CVS repository is browsable here: <a href="https://webwork.dev.java.net/source/browse/webwork/src/java" title="Visit page outside Confluence">&#104;ttps://webwork.dev.java.net/source/browse/webwork/src/java</a>)</p>

<p><br clear="all" />
<em>Tip:</em><br/>
Jason/Patrick note that one nifty thing you can do with this tool is to call static class methods. That's rather handy since Velocity doesn't offer access to class variables or methods, but only to instantiate objects that have been placed in the Velocity Context.  So you can't normally do things like Math.random().</p>

<p>To call a class method, from within Velocity template, using the OGNL tool, you do this:</p>

<div class="code"><div class="codeContent">
<pre class="code-java">$ognl.findValue(<span class="code-quote">"@com.acme.FooClass@FOO"</span>)</pre>
</div></div>

<p><em>TODO:</em> the original email detailing the above example used $value to refer to the OGNL tool, not $ognl.  But the source indicates it's "$ognl" that's shared with the context.  Which is right?</p>

<p><br clear="all" />
<b>$webwork</b><br/>
A reference to the VelocityWebWorkUtil class. (<a href="http://www.opensymphony.com/webwork/api/com/opensymphony/webwork/util/WebWorkUtil.html" title="Visit page outside Confluence">API Docs</a>)</p>

<p>At the time of this writing, the API docs for this object are effectively blank, so if you really want to know how it works, be a <a href="http://en.wikipedia.org/wiki/Jedi" title="Visit page outside Confluence">Jedi</a> and "use the source".  (The CVS repository is browsable here: <a href="https://webwork.dev.java.net/source/browse/webwork/src/java" title="Visit page outside Confluence">&#104;ttps://webwork.dev.java.net/source/browse/webwork/src/java</a>)</p>

<p><br clear="all" />
<em>Tip:</em><br/>
Mathew notes that the VelocityWebWorkUtil class can instantiate other objects for you.  This, too, is very handy since Velocity is normally constrained to only the objects that have been explicitely shared with it's context (and not something you have control over when using Velocity templates kicked off by WebWork).</p>

<p>To instantiate an object from a Velocity page (that's been kicked off by WebWork, of course) do this:</p>

<div class="code"><div class="codeContent">
<pre class="code-java">#set($object = $webwork.bean(<span class="code-quote">"com.foo.ClassName"</span>))</pre>
</div></div>

<p>This technique can be particularly handy for grabbing a reference to one of the <a href="http://jakarta.apache.org/velocity/tools/" title="Visit page outside Confluence">VelocityTools</a> objects. (The VelocityTools are not included with WebWork, you'll need to go grab the lib and put it in your classpath if you want to use $webwork.bean() to grab references to the tool objects.)</p>

<p>(Note: If you're rumaging through the source, the source-code for the $webwork.bean() method above is really in VelocityWebWorkUtil's parent class WebWorkUtil.)</p>

<p><br clear="all" />
<b>$action</b><br/>
A reference to the action context that called this template.  <em>TODO:</em> Not really sure what's in there or what it's good for.  Should probably note that.</p>

<p><br clear="all" />
<b>#tag</b> and <b>#bodytag</b>#</p>

<p>Provides a way of using a JSP taglib from velocity.<br/>
Many, but not all taglibs can be used. </p>

<p>ex:</p>
<div class="code"><div class="codeContent">
<pre class="code-java">#tag( Text <span class="code-quote">"name='title.edit'"</span> )</pre>
</div></div>
<p>provides a way to uses the &lt;ww:text name="title.edit" /&gt; tag from velocity.</p>

<p>Note the &lt;ww:text /&gt; is probably not that useful from velocity since <br/>
<div class="code"><div class="codeContent">
<pre class="code-java">$action.getText('title.edit')</pre>
</div></div> would perform the same thing.</p>

<p>see <a href="UI tags.html#UITags-WW%2FUITags" title="WW/UI+Tags on UI Tags">UI tags#WW/UI+Tags</a> for more information about webworks tags.  Many provide equivalent velocity examples.  Usage with other tags could be infered based on examples given. </p>





                    			    </td>
		    </tr>
	    </table>
    </body>
</html>
