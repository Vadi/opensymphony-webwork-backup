<html>
    <head>
        <title>WebWork - 
        TokenInterceptor
         </title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <p>The TokenInterceptor, or TokenSessionInterceptor, is useful in preventing double submission of a form.  The difference between the two is merely that the TokenSessionInterceptor places the double-submission data into the HttpSession, so that you may access it again if needed.  If your application is content to simply discard this data as an error, just use the TokenInterceptor.  It is never necessary to use both.</p>

<p>In order to use it on a particular action, you must do several things:</p>

<ul>
	<li>include an interceptor-ref description on the action in xwork.xml that contains one of the two interceptors</li>
	<li>include a result mapping for the "invalid.token" result, which may be returned by the interceptor</li>
	<li>on each page that references the action, include a &lt;ww:token/&gt; tag (or the Velocity version)</li>
</ul>


<p>Let's say you have an Action called DeleteImportantItemAction.  You might use the following action configuration in your xwork.xml:</p>

<div class="code"><div class="codeContent">
<pre class="code-xml"><span class="code-tag">&lt;action name=<span class="code-quote">"delete"</span> class=<span class="code-quote">"com.example.action.DeleteImportantItemAction"</span>&gt;</span>
    <span class="code-tag">&lt;result name=<span class="code-quote">"input"</span> type=<span class="code-quote">"dispatcher"</span>&gt;</span>/WEB-INF/views/delete.jsp<span class="code-tag">&lt;/result&gt;</span>
    <span class="code-tag">&lt;result name=<span class="code-quote">"success"</span> type=<span class="code-quote">"chain"</span>&gt;</span>view-item<span class="code-tag">&lt;/result&gt;</span>
    <span class="code-tag">&lt;result name=<span class="code-quote">"invalid.token"</span> type=<span class="code-quote">"chain"</span>&gt;</span>view-item<span class="code-tag">&lt;/result&gt;</span>

    <span class="code-tag">&lt;interceptor-ref name=<span class="code-quote">"defaultStack"</span>/&gt;</span>
    <span class="code-tag">&lt;interceptor-ref name=<span class="code-quote">"token"</span>/&gt;</span>
<span class="code-tag">&lt;/action&gt;</span></pre>
</div></div>

<p>You'll need to put a &lt;ww:token/&gt; tag on the page that initially calls your action, if it's not delete.jsp, as well as on delete.jsp itself.  Otherwise, the Interceptor will short-circuit your action and instead, return the invalid.token result.  Additionally, it will place an ActionError, "The form has already been processed or no token was supplied" on the Action.</p>

<p>A slightly less secure but simpler alternative to using tokens is to use a Redirect result:</p>

<div class="code"><div class="codeContent">
<pre class="code-xml"><span class="code-tag">&lt;action name=<span class="code-quote">"delete"</span> class=<span class="code-quote">"com.example.action.DeleteImportantItemAction"</span>&gt;</span>
    <span class="code-tag">&lt;result name=<span class="code-quote">"input"</span> type=<span class="code-quote">"dispatcher"</span>&gt;</span>/WEB-INF/views/delete.jsp<span class="code-tag">&lt;/result&gt;</span>
    <span class="code-tag">&lt;result name=<span class="code-quote">"success"</span> type=<span class="code-quote">"redirect"</span>&gt;</span>view-item.action<span class="code-tag">&lt;/result&gt;</span>
<span class="code-tag">&lt;/action&gt;</span></pre>
</div></div>

<p>If you use a workflow, with a middle-stage of confirming that the user wants to do the delete, you may wish to break that out into two actions.  A token isn't needed for the confirm step, but there is no way to configure a token for some results and not others in the same action (except possibly by writing your own TokenInterceptor, but why bother when it already exists?).  You can certainly do something like:</p>

<div class="code"><div class="codeContent">
<pre class="code-xml"><span class="code-tag">&lt;action name=<span class="code-quote">"delete-confirm"</span> class=<span class="code-quote">"com.example.action.DeleteImportantItemAction"</span>&gt;</span>
    <span class="code-tag">&lt;result name=<span class="code-quote">"inut"</span> type=<span class="code-quote">"dispatcher"</span>&gt;</span>/WEB-INF/views/delete.jsp<span class="code-tag">&lt;/result&gt;</span>
    <span class="code-tag">&lt;result name=<span class="code-quote">"success"</span> type=<span class="code-quote">"chain"</span>&gt;</span>view-item<span class="code-tag">&lt;/result&gt;</span>
<span class="code-tag">&lt;/action&gt;</span>

<span class="code-tag">&lt;action name=<span class="code-quote">"delete"</span> class=<span class="code-quote">"com.example.action.DeleteImportantItemAction"</span>&gt;</span>
    <span class="code-tag">&lt;result name=<span class="code-quote">"success"</span> type=<span class="code-quote">"chain"</span>&gt;</span>view-item<span class="code-tag">&lt;/result&gt;</span>
    <span class="code-tag">&lt;result name=<span class="code-quote">"invalid.token"</span> type=<span class="code-quote">"chain"</span>&gt;</span>view-item<span class="code-tag">&lt;/result&gt;</span>

    <span class="code-tag">&lt;interceptor-ref name=<span class="code-quote">"defaultStack"</span>/&gt;</span>
    <span class="code-tag">&lt;interceptor-ref name=<span class="code-quote">"token"</span>/&gt;</span>
<span class="code-tag">&lt;/action&gt;</span></pre>
</div></div>


                    			    </td>
		    </tr>
	    </table>
    </body>
</html>
