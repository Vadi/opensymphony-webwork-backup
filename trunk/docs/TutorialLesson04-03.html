<html>
    <head>
        <title>TutorialLesson04-03</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">

				    <p class="paragraph"><h1 class="heading1"> Lesson 4.3: Using Freemarker with WebWork</h1></p>Freemarker is a powerfull template engine that competes with Velocity. You can learn more about it in the project&#039;s homepage: <span class="nobr"><a href="http://freemarker.sourceforge.net">&#104;ttp://freemarker.sourceforge.net<sup><img src="./icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="&gt;&gt;" border="0"/></sup></a></span>.<p class="paragraph">First of all, to use Freemarker with Webwork, you have to place the freemarker.jar in your <tt class="monospaced">WEB-INF\lib</tt> folder. You can download the distribution <span class="nobr"><a href="http://freemarker.sourceforge.net/freemarkerdownload.html">here<sup><img src="./icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="&gt;&gt;" border="0"/></sup></a></span>.</p>After that, just configure <tt class="monospaced">web.xml</tt> and start writing your templates, as explained below.
<p class="paragraph"><h3 class="heading3"> web.xml:</h3></p>To use Freemarker as the view, you need to modify <tt class="monospaced">web.xml</tt> and add a servlet and a servlet mapping for <tt class="monospaced">FreemarkerServlet</tt>, as demonstrated below:

<div class="code"><pre>&lt;servlet&gt;&#10;	&lt;servlet&#45;name&gt;freemarker&lt;/servlet&#45;name&gt;&#10;	&lt;servlet&#45;class&gt;com.opensymphony.webwork.views.freemarker.FreemarkerServlet&lt;/servlet&#45;class&gt;&#10;		&lt;&#33;&#45;&#45; FreemarkerServlet settings&#58; &#45;&#45;&gt;&#10;		&lt;init&#45;param&gt;&#10;			&lt;param&#45;name&gt;TemplatePath&lt;/param&#45;name&gt;&#10;			&lt;param&#45;value&gt;/&lt;/param&#45;value&gt;&#10;		&lt;/init&#45;param&gt;&#10;		&lt;init&#45;param&gt;&#10;			&lt;param&#45;name&gt;NoCache&lt;/param&#45;name&gt;&#10;			&lt;param&#45;value&gt;true&lt;/param&#45;value&gt;&#10;		&lt;/init&#45;param&gt;&#10;		&lt;init&#45;param&gt;&#10;			&lt;param&#45;name&gt;ContentType&lt;/param&#45;name&gt;&#10;			&lt;param&#45;value&gt;text/html&lt;/param&#45;value&gt;&#10;		&lt;/init&#45;param&gt;&#10;		&lt;init&#45;param&gt;&#10;			&lt;param&#45;name&gt;default&#95;encoding&lt;/param&#45;name&gt;&#10;			&lt;param&#45;value&gt;ISO&#45;8859&#45;1&lt;/param&#45;value&gt;&#10;		&lt;/init&#45;param&gt;&#10;		&lt;init&#45;param&gt;&#10;			&lt;param&#45;name&gt;number&#95;format&lt;/param&#45;name&gt;&#10;			&lt;param&#45;value&gt;0.##########&lt;/param&#45;value&gt;&#10;		&lt;/init&#45;param&gt;&#10;	&lt;load&#45;on&#45;startup&gt;1&lt;/load&#45;on&#45;startup&gt;&#10;&lt;/servlet&gt;&#10;&#10;&lt;servlet&#45;mapping&gt; &#10;	&lt;servlet&#45;name&gt;freemarker&lt;/servlet&#45;name&gt; &#10;	&lt;url&#45;pattern&gt;&#42;.ftl&lt;/url&#45;pattern&gt; &#10;&lt;/servlet&#45;mapping&gt;</pre></div><p class="paragraph">The configuration above means that Freemarker templates can be rendered through requests to <tt class="monospaced">.ftl</tt> pages. That also means that you should implement security checks in your templates so an user doesn&#039;t access it directly without going through an action first (if that is required). But you can always place your Freemarker files under WEB-INF so they become unaccessible to direct requests. We will use the latter approach in our examples.</p>Inside a Freemarker template, you will have access to every object managed by WebWork with the following syntax:
<ul class="star">
<li> <b class="strong"><tt class="monospaced">$stack</tt></b> = <tt class="monospaced">OgnlValueStack</tt>;</li>
<li> <b class="strong"><tt class="monospaced">$wwUtil</tt></b> = <tt class="monospaced">FreemarkerUtil</tt>, a toolbox providing services like formatting url, accessing the value stack, etc;</li>
<li> <b class="strong"><tt class="monospaced">$name-of-property</tt></b> = property retrieved from the value stack. If that fails, it looks up an attribute with that name in the <tt class="monospaced">HttpServletRequest</tt>, <tt class="monospaced">HttpSession</tt> and <tt class="monospaced">ServletContext</tt>, in that order;</li>
<li> <b class="strong"><tt class="monospaced">$Request</tt></b> = <tt class="monospaced">HttpServletRequest</tt>;</li>
<li> <b class="strong"><tt class="monospaced">$Session</tt></b> = <tt class="monospaced">HttpServletResponse</tt>;</li>
<li> <b class="strong"><tt class="monospaced">$Application</tt></b> = <tt class="monospaced">OgnlValueStack</tt>.</li>
</ul><br/>
The example below does the same thing as example 2 from <a href="TutorialLesson03.html">lesson 3</a>, but now, using Freemarker templates.
<p class="paragraph"><h3 class="heading3"> xwork.xml:</h3>
<div class="code"><pre>&lt;&#33;DOCTYPE xwork PUBLIC &quot;&#45;//OpenSymphony Group//XWork 1.0//EN&quot; &#10;&quot;http&#58;//www.opensymphony.com/xwork/xwork&#45;1.0.dtd&quot;&gt;&#10;&#10;&lt;xwork&gt;&#10;	&lt;&#33;&#45;&#45; Include webwork defaults (from WebWork&#45;2.1 JAR). &#45;&#45;&gt;&#10;	&lt;include file=&quot;webwork&#45;default.xml&quot; /&gt;&#10;	&#10;	&lt;&#33;&#45;&#45; Configuration for the default package. &#45;&#45;&gt;&#10;	&lt;package name=&quot;default&quot; extends=&quot;webwork&#45;default&quot;&gt;&#10;		&lt;&#33;&#45;&#45; Default interceptor stack. &#45;&#45;&gt; &#10;		&lt;default&#45;interceptor&#45;ref name=&quot;defaultStack&quot; /&gt; &#10;		&#10;		&lt;&#33;&#45;&#45; Action&#58; Lesson 4.3&#58; HelloAction. &#45;&#45;&gt;&#10;		&lt;action name=&quot;indexFreemarker&quot; class=&quot;com.opensymphony.xwork.ActionSupport&quot;&gt;&#10;			&lt;result name=&quot;success&quot; type=&quot;dispatcher&quot;&gt;/WEB&#45;INF/ftl/lesson3/index.ftl&lt;/result&gt;&#10;		&lt;/action&gt;&#10;&#10;		&lt;action name=&quot;helloFreemarker&quot; class=&quot;lesson03.HelloAction&quot;&gt;&#10;			&lt;result name=&quot;error&quot; type=&quot;dispatcher&quot;&gt;/WEB&#45;INF/ftl/lesson3/index.ftl&lt;/result&gt;&#10;			&lt;result name=&quot;success&quot; type=&quot;dispatcher&quot;&gt;/WEB&#45;INF/ftl/test/success.ftl&lt;/result&gt;&#10;		&lt;/action&gt;&#10;	&lt;/package&gt;&#10;&lt;/xwork&gt;</pre></div></p><h3 class="heading3"> HelloAction.java (same as lesson 3):</h3>
<div class="code"><pre><span class="java&#45;keyword">package</span> lesson03;&#10;&#10;<span class="java&#45;keyword">import</span> com.opensymphony.xwork.ActionSupport;&#10;&#10;<span class="java&#45;keyword">public</span> class HelloAction <span class="java&#45;keyword">extends</span> ActionSupport &#123;&#10;	<span class="java&#45;object">String</span> person;&#10;	<span class="java&#45;keyword">public</span> <span class="java&#45;object">String</span> getPerson() &#123;&#10;		<span class="java&#45;keyword">return</span> person;&#10;	&#125;&#10;	<span class="java&#45;keyword">public</span> void setPerson(<span class="java&#45;object">String</span> person) &#123;&#10;		<span class="java&#45;keyword">this</span>.person = person;&#10;	&#125;&#10;	<span class="java&#45;keyword">public</span> <span class="java&#45;object">String</span> execute() <span class="java&#45;keyword">throws</span> Exception &#123;&#10;		<span class="java&#45;keyword">if</span> ((person == <span class="java&#45;keyword">null</span>) || (person.length() == 0)) <span class="java&#45;keyword">return</span> ERROR;&#10;		<span class="java&#45;keyword">else</span> <span class="java&#45;keyword">return</span> SUCCESS;&#10;	&#125;&#10;&#125;</pre></div>
<p class="paragraph"><h3 class="heading3"> ex02-index.ftl</h3>
<div class="code"><pre>&lt;#assign ww=JspTaglibs&#91;&quot;/WEB&#45;INF/lib/webwork.tld&quot;&#93; /&gt;&#10;&#10;&lt;html&gt;&#10;&lt;head&gt;&#10;&lt;title&gt;WebWork Tutorial &#45; Lesson 4.3 &#45; Example 1&lt;/title&gt;&#10;&lt;/head&gt;&#10;&#10;&lt;body&gt;&#10;&#10;&lt;p&gt;Click &lt;a href=&quot;$&#123;wwUtil.buildUrl(&#039;indexFreemarker.action&#039;)&#125;&quot;&gt;here&lt;/a&gt; to reload <span class="java&#45;keyword">this</span> page.&lt;/p&gt;&#10;&#10;&lt;&#64;ww.form name=&quot;&#039;nameForm&#039;&quot; action=&quot;&#039;helloFreemarker.action&#039;&quot; method=&quot;&#039;POST&#039;&quot;&gt;&#10;	&lt;&#64;ww.textfield label=&quot;&#039;What is your name &#63;&#039;&quot; name=&quot;&#039;person&#039;&quot; value=&quot;person&quot; size=&quot;20&quot;/&gt;&#10;	&lt;&#64;ww.submit name=&quot;&#039;submit&#039;&quot; value=&quot;&#039;Submit&#039;&quot;/&gt;&#10;&lt;/&#64;ww.form&gt;&#10;&#10;&lt;/body&gt;&#10;&lt;/html&gt;</pre></div></p>If you don&#039;t want to use WebWork&#039;s UI Tags, you could do it like this:<p class="paragraph"><h3 class="heading3"> ex02-index-notags.ftl</h3>
<div class="code"><pre>&lt;html&gt;&#10;&lt;head&gt;&#10;&lt;title&gt;WebWork Tutorial &#45; Lesson 4.3 &#45; Example 1&lt;/title&gt;&#10;&lt;/head&gt;&#10;&#10;&lt;body&gt;&#10;&#10;&lt;p&gt;Click &lt;a href=&quot;$&#123;wwUtil.buildUrl(&#039;indexFreemarker.action&#039;)&#125;&quot;&gt;here&lt;/a&gt; to reload <span class="java&#45;keyword">this</span> page.&lt;/p&gt;&#10;&#10;&lt;form name=&quot;nameForm&quot; action=&quot;$&#123;wwUtil.buildUrl(&#039;helloFreemarker.action&#039;)&#125;&quot; method=&quot;POST&quot;&gt;&#10;	What is your name &#63; &#10;	&lt;input type=&quot;text&quot; name=&quot;person&quot; value=&quot;$&#123;person&#125;&quot; size=&quot;20&quot;&gt;&#10;	&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Submit&quot;&gt;&#10;&lt;/form&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;</pre></div></p>However, if you choose no to use tags, it&#039;s recommended that you use Freemarker Macros to write the form elements.
<p class="paragraph"><h3 class="heading3"> ex02-success.ftl:</h3>
<div class="code"><pre>&lt;#assign ww=JspTaglibs&#91;&quot;/WEB&#45;INF/lib/webwork.tld&quot;&#93; /&gt;&#10;&#10;&lt;html&gt; &#10;&lt;head&gt; &#10;&lt;title&gt;WebWork Tutorial &#45; Lesson 4.3 &#45; Example 1&lt;/title&gt; &#10;&lt;/head&gt; &#10;&lt;body&gt; &#10;&#10;Come from the property WW tag (taglibs support) &#58; &lt;&#64;ww.property value=&quot;person&quot;/&gt; &lt;br&gt;&#10;Come from the Freemarker lookup in the WW stack &#58; $&#123;person&#125;&#10;&#10;&lt;/body&gt; &#10;&lt;/html&gt;</pre></div></p>You can use either WebWork <tt class="monospaced">property</tt> tag or the Freemarker <tt class="monospaced">$person</tt> reference. Both of them return the same thing: a property from the action class.<p class="paragraph"><hr class="line"/></p><a href="TutorialLesson04-02.html">Previous Lesson</a> | <a href="TutorialLesson05.html">Next Lesson</a>



				    
			    </td>
		    </tr>
	    </table>
    </body>
</html>
